<!DOCTYPE html>
<html lang="en">
    <head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
    <meta charset="UTF-8" />

    <meta name="generator" content="Hugo 0.115.1"><meta name="theme-color" content="#fff" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <meta name="format-detection" content="telephone=no, date=no, address=no, email=no" />
    
    <meta http-equiv="Cache-Control" content="no-transform" />
    
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>Taking Firecracker for a spin | gruchalski.com</title>

    <link rel="stylesheet" href="/css/meme.min.8997f67dc85e0ae44653b11b87b2c4c793c17cb9b8b5c64a2b005b52cd948306.css"/>

    
    
        <script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js" defer></script><script src="/js/meme.min.1321582b41a9fdb1a15023a3d3204fa013ace575e4c594c9dbc43078a016fce0.js"></script>

    

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM&#43;Plex&#43;Serif:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;family=Amaranth&amp;display=swap" media="print" onload="this.media='all'" />
        <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM&#43;Plex&#43;Serif:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;family=Amaranth&amp;display=swap" /></noscript>

    <meta name="author" content="Radek Gruchalski" /><meta name="description" content="Doing semi-meaningful things with Firecracker" />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#2a6df4" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="gruchalski.com" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="gruchalski.com" />
    <meta name="msapplication-starturl" content="../../" />
    <meta name="msapplication-TileColor" content="#fff" />
    <meta name="msapplication-TileImage" content="../../icons/mstile-150x150.png" />
    <link rel="manifest" href="/manifest.json" />

    
    

    
    
        <link rel="canonical" href="https://gruchalski.com/posts/2021-02-06-taking-firecracker-for-a-spin/" />
    

    

<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "datePublished": "2021-02-06T00:00:00+00:00",
        "dateModified": "2023-07-04T23:40:31+02:00",
        "url": "https://gruchalski.com/posts/2021-02-06-taking-firecracker-for-a-spin/",
        "headline": "Taking Firecracker for a spin",
        "description": "Doing semi-meaningful things with Firecracker",
        "inLanguage" : "en",
        "articleSection": "posts",
        "wordCount":  2338 ,
        "image": ["https://gruchalski.com/assets/posts/2021-02-06-taking-firecracker-for-a-spin/no-idea-what-im-doing.png"],
        "author": {
            "@type": "Person",
            "email": "radek@gruchalski.com",
            "image": "https://gruchalski.com/icons/apple-touch-icon.png",
            "url": "https://io-oi.me/",
            "name": "radek gruchalski"
        },
        "license": "[reposting requires attribution, **use canonical links** »](https://en.wikipedia.org/wiki/Canonical_link_element)",
        "publisher": {
            "@type": "Organization",
            "name": "gruchalski.com",
            "logo": {
                "@type": "ImageObject",
                "url": "https://gruchalski.com/icons/apple-touch-icon.png"
            },
            "url": "https://gruchalski.com/"
        },
        "mainEntityOfPage": {
            "@type": "WebSite",
            "@id": "https://gruchalski.com/"
        }
    }
</script>

    

<meta name="twitter:card" content="summary_large_image" />



    



<meta property="og:title" content="Taking Firecracker for a spin" />
<meta property="og:description" content="Doing semi-meaningful things with Firecracker" />
<meta property="og:url" content="https://gruchalski.com/posts/2021-02-06-taking-firecracker-for-a-spin/" />
<meta property="og:site_name" content="gruchalski.com" />
<meta property="og:locale" content="en" /><meta property="og:image" content="https://gruchalski.com/assets/posts/2021-02-06-taking-firecracker-for-a-spin/no-idea-what-im-doing.png" />
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2021-02-06T00:00:00&#43;00:00" />
    <meta property="article:modified_time" content="2023-07-04T23:40:31&#43;02:00" />
    
    <meta property="article:section" content="posts" />



    
    

    
</head>

    <body>
        <div class="container">
            
    <header class="header">
        
            <div class="header-wrapper">
                <div class="header-inner single">
                    
    <div class="site-brand">
        
            <a href="/" class="brand">gruchalski.com</a>
        
    </div>

                    <nav class="nav">
    <ul class="menu" id="menu">
        
            
        
        
        
        
            
                <li class="menu-item"><a href="/posts/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon archive"><path d="M32 448c0 17.7 14.3 32 32 32h384c17.7 0 32-14.3 32-32V160H32v288zm160-212c0-6.6 5.4-12 12-12h104c6.6 0 12 5.4 12 12v8c0 6.6-5.4 12-12 12H204c-6.6 0-12-5.4-12-12v-8zM480 32H32C14.3 32 0 46.3 0 64v48c0 8.8 7.2 16 16 16h480c8.8 0 16-7.2 16-16V64c0-17.7-14.3-32-32-32z"/></svg><span class="menu-item-name">posts</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" class="icon code-branch"><path d="M384 144c0-44.2-35.8-80-80-80s-80 35.8-80 80c0 36.4 24.3 67.1 57.5 76.8-.6 16.1-4.2 28.5-11 36.9-15.4 19.2-49.3 22.4-85.2 25.7-28.2 2.6-57.4 5.4-81.3 16.9v-144c32.5-10.2 56-40.5 56-76.3 0-44.2-35.8-80-80-80S0 35.8 0 80c0 35.8 23.5 66.1 56 76.3v199.3C23.5 365.9 0 396.2 0 432c0 44.2 35.8 80 80 80s80-35.8 80-80c0-34-21.2-63.1-51.2-74.6 3.1-5.2 7.8-9.8 14.9-13.4 16.2-8.2 40.4-10.4 66.1-12.8 42.2-3.9 90-8.4 118.2-43.4 14-17.4 21.1-39.8 21.6-67.9 31.6-10.8 54.4-40.7 54.4-75.9zM80 64c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm0 384c-8.8 0-16-7.2-16-16s7.2-16 16-16 16 7.2 16 16-7.2 16-16 16zm224-320c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16z"/></svg><span class="menu-item-name">categories</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/tags/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="icon tags"><path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"/></svg><span class="menu-item-name">tags</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/about/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="icon user-circle"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"/></svg><span class="menu-item-name">about</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/privacy/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512" class="icon info"><path d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"/></svg><span class="menu-item-name">privacy</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href=""></a>
                </li>
            
        
            
                
            
        
    </ul>
</nav>

                    
                </div>
            </div>
            
    <input type="checkbox" id="nav-toggle" aria-hidden="true" />
    <label for="nav-toggle" class="nav-toggle"></label>
    <label for="nav-toggle" class="nav-curtain"></label>


        
    </header>




            
            
    <main class="main single" id="main">
    <div class="main-inner">

        

        <article class="content post h-entry" data-align="default" data-type="posts" data-toc-num="true">

            <h1 class="post-title p-name">Taking Firecracker for a spin</h1>

            

            
                <div class="post-description p-summary">Doing semi-meaningful things with Firecracker</div>
                
            

            
                

<div class="post-meta">
    
        
        <time datetime="2021-02-06T00:00:00&#43;00:00" class="post-meta-item published dt-published"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"/></svg>&nbsp;February 6, 2021</time>
    
    
    
    
        
        
        
    
    
        
        <span class="post-meta-item wordcount"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;2338</span>
    
    
        
        <span class="post-meta-item reading-time"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;11&nbsp;mins</span>
    
    
    
</div>

            

            

            <div class="post-body e-content">
              <p><a href="https://github.com/firecracker-microvm/firecracker" target="_blank" rel="noopener">Firecracker</a><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">[1]</a></sup> is recently making rounds on the internet as this relatively new, awesome technology for running lightweight VMs.</p>
<p>As something coming from AWS and powering AWS Lambda, my original perception was that it&rsquo;s not easy to set up and use. However, <a href="https://jvns.ca/blog/2021/01/23/firecracker--start-a-vm-in-less-than-a-second/" target="_blank" rel="noopener">this write from Julia Evans</a><sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">[2]</a></sup> proved me wrong. So, as I have recently picked up a used Dell R720 with decent amount of RAM and CPUs, it was time to take these two for a spin together.</p>
<p>Sipping the first coffee this gloomy Nürburgring weather morning, the thought of putting Vault on Firecracker seemed somewhat amusing, &hellip; and the day was gone.</p>
<p>I&rsquo;m going to show you how I&rsquo;ve done it. Do I like Firecracker? It&rsquo;s been only one day but yes, it&rsquo;s pretty neat and easy to use.</p>
<h2 id="environment"><a href="#environment" class="anchor-link">§</a>Environment</h2>
<p>Clean HWE Ubuntu 18.04.5 Server installation with the password-less <code>sudoer</code> user.</p>
<h2 id="intro"><a href="#intro" class="anchor-link">§</a>Intro</h2>
<p>A Firecracker VM requires a Linux Linux Kernel and a root file system. Most of the people who talk about Firecracker use example <code>hello-vmlinux</code> and a root file system from AWS. I wanted to learn how to build these myself so I went with building my own <code>5.8</code> kernel and a root file system extracted from the default official HashiCorp Vault Docker image. The steps:</p>
<ul>
<li>install all the software required to build Linux kernel and install Docker</li>
<li>setup directory structure to work with</li>
<li>install Firecracker</li>
<li>get, configure and build Linux kernel</li>
<li>extract Vault file system from a running container</li>
<li>run Vault Firecracker microVM</li>
</ul>
<h2 id="dependencies"><a href="#dependencies" class="anchor-link">§</a>Dependencies</h2>
<p>To avoid multiple <code>apt-get update</code>s, add Docker repository first:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">curl -fsSL https://download.docker.com/linux/ubuntu/gpg <span class="p">|</span> sudo apt-key add -
</span></span><span class="line"><span class="cl">sudo add-apt-repository <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   <span class="s2">&#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu \
</span></span></span><span class="line"><span class="cl"><span class="s2">   </span><span class="k">$(</span>lsb_release -cs<span class="k">)</span><span class="s2"> \
</span></span></span><span class="line"><span class="cl"><span class="s2">   stable&#34;</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Next, install all the software required to compile the kernel:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get install <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    bison <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    build-essential <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    flex <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    git <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libelf-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libncurses5-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libssl-dev -y
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>followed by Docker dependencies:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo apt-get install <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    curl <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    gnupg-agent <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    software-properties-common -y
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>and finally, Docker itself:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo apt-get install <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    docker-ce <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    docker-ce-cli <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    containerd.io -y
</span></span><span class="line"><span class="cl">sudo groupadd docker <span class="c1"># this may report that the group already exists</span>
</span></span><span class="line"><span class="cl">sudo usermod -aG docker <span class="nv">$USER</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h2 id="setup-the-directory-structure"><a href="#setup-the-directory-structure" class="anchor-link">§</a>Setup the directory structure</h2>
<p>To have everything in one place, create the following directories:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo mkdir -p /firecracker
</span></span><span class="line"><span class="cl">sudo chown -R <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> /firecracker
</span></span><span class="line"><span class="cl">mkdir -p /firecracker/<span class="o">{</span>configs,filesystems,kernels,linux.git,releases<span class="o">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><ul>
<li><code>configs</code>: this is where we will put the VM config JSON files</li>
<li><code>filesystems</code>: this is where the extracted file systems will reside</li>
<li><code>kernels</code>: this directory contains pre-built Linux kernels</li>
<li><code>linux.git</code>: Linux sources go here</li>
<li><code>releases</code>: Firecracker releases will be installed here</li>
</ul>
<h2 id="install-firecracker"><a href="#install-firecracker" class="anchor-link">§</a>Install Firecracker</h2>
<p>This is as simple as downloading a pre-built binary release from GitHub and putting it on the <code>PATH</code>. I wanted to have versioning available for ease of upgrading in the future so I&rsquo;ve built a shell program to manage this for me. <a href="https://github.com/radekg/firecracker-hashicorp-vault" target="_blank" rel="noopener">You can find the program in this repository on GitHub</a><sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">[3]</a></sup>. Long story, short:</p>
<ul>
<li>download <code>install-firecracker.sh</code> program and put it in <code>/firecracker</code> directory; technically does not matter where but the program assumes the <code>/firecracker/...</code> directory structure from the previous step</li>
<li><code>chmod +x /firecracker/install-firecracker.sh</code></li>
<li>run: <code>sudo /firecracker/install-firecracker.sh</code></li>
</ul>
<p>This will download the latest Firecracker release, install the release in <code>/firecracker/releases</code> directory and create <code>/usr/bin/firecracker-&lt;version&gt;</code> and <code>/usr/bin/jailer-&lt;version&gt;</code> links. You&rsquo;ll also get <code>/usr/bin/firecracker</code> and <code>/usr/bin/jailer</code> links pointing to the version links. You can now run Firecracker:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">firecracker --help
</span></span></code></pre></td></tr></table></div>
</div>
</div><h2 id="get-linux-kernel"><a href="#get-linux-kernel" class="anchor-link">§</a>Get Linux Kernel</h2>
<p>I&rsquo;m going to use <code>5.8</code> kernel. Do I need one? Not sure but why not.</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">KERNEL_VERSION</span><span class="o">=</span>v5.8
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Clone sources from GitHub:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">cd</span> /firecracker/linux.git
</span></span><span class="line"><span class="cl">git clone https://github.com/torvalds/linux.git .
</span></span><span class="line"><span class="cl">git checkout <span class="si">${</span><span class="nv">KERNEL_VERSION</span><span class="si">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h2 id="configure-the-kernel"><a href="#configure-the-kernel" class="anchor-link">§</a>Configure the kernel</h2>
<p>So, I&rsquo;m not really fluent at this and&hellip;</p>
<p><img src="/assets/posts/2021-02-06-taking-firecracker-for-a-spin/no-idea-what-im-doing.png" alt="I have no idea what I&rsquo;m doing"></p>
<p>This is the first time I&rsquo;m building the kernel but fortunately <a href="https://github.com/firecracker-microvm/firecracker/blob/master/docs/rootfs-and-kernel-setup.md" target="_blank" rel="noopener">one of the the Firecracker getting started documents</a> points to a <a href="https://github.com/firecracker-microvm/firecracker/blob/master/resources/microvm-kernel-x86_64.config" target="_blank" rel="noopener">recommended kernel config</a>. What&rsquo;s less fortunate, the document talks about kernel <code>v4.20</code> and the config is for <code>v4.14.174</code>. I&rsquo;ve downloaded the file and placed it in <code>/firecracker/linux.git/.config</code> anyway but when I tried building the <code>v5.8</code> kernel, <code>make</code> was insisting on recreating the config and asked me a lot of questions about what I want.</p>
<p>I don&rsquo;t know what I want and I don&rsquo;t know if <code>make</code> took the values from the old <code>.config</code> so I basically held <code>Enter</code> down for a bit. <code>make</code> moved my <code>.config</code> to <code>.config.old</code> and gave me a new <code>.config</code> file for <code>v5.8</code> kernel. I took the new generated file and compared it with the original <code>v4.14.174</code> config.</p>
<p>These files have few thousand lines so I wrote a program in Golang which loads both versions and compares the values.</p>
<p>With a flag, it allows bringing non-existing values from the <code>good config</code> to the new one. You can find this program in the <code>kernel-configs</code> directory of <a href="https://github.com/radekg/firecracker-hashicorp-vault" target="_blank" rel="noopener">this repository</a>[]. To get the <code>v5.8</code> config, I basically executed:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">go run ./compare-configs.go <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --good-config<span class="o">=</span>./4.14.174.config <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --new-config<span class="o">=</span>./5.8.config <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --bring-old-non-existing
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Next, I&rsquo;ve replaced the <code>/firecracker/linux.git/.config</code> file contents with the result of my <code>compare configs</code> program and re-run kernel build. This time, it did not insist on recreating anything and used my config, definitely. Happy times!</p>
<h2 id="build-the-kernel"><a href="#build-the-kernel" class="anchor-link">§</a>Build the kernel</h2>
<p>You probably want to change the value of <code>-j</code> to something like <code>4</code> or <code>8</code>. The build will take a bit more time.</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">time</span> make vmlinux -j32
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">  LD      vmlinux.o
</span></span><span class="line"><span class="cl">  MODPOST vmlinux.symvers
</span></span><span class="line"><span class="cl">  MODINFO modules.builtin.modinfo
</span></span><span class="line"><span class="cl">  GEN     modules.builtin
</span></span><span class="line"><span class="cl">  LD      .tmp_vmlinux.kallsyms1
</span></span><span class="line"><span class="cl">  KSYM    .tmp_vmlinux.kallsyms1.o
</span></span><span class="line"><span class="cl">  LD      .tmp_vmlinux.kallsyms2
</span></span><span class="line"><span class="cl">  KSYM    .tmp_vmlinux.kallsyms2.o
</span></span><span class="line"><span class="cl">  LD      vmlinux
</span></span><span class="line"><span class="cl">  SORTTAB vmlinux
</span></span><span class="line"><span class="cl">  SYSMAP  System.map
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">real	0m54.052s
</span></span><span class="line"><span class="cl">user	23m51.313s
</span></span><span class="line"><span class="cl">sys	2m35.287s
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>After the build is complete, copy the <code>vmlinux</code> binary to the <code>/firecracker/kernels</code> directory:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">mv ./vmlinux /firecracker/kernels/vmlinux-<span class="si">${</span><span class="nv">KERNEL_VERSION</span><span class="si">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h2 id="build-the-file-system"><a href="#build-the-file-system" class="anchor-link">§</a>Build the file system</h2>
<p>Fun part starts here. The article from Julia Evans talks about getting an <code>init</code> system installed in the container. I have naively tried simply extracting the file system and running it bluntly without doing any additional configuration but Firecracker was complaining about not having <code>/sbin/openrc</code> available. Makes sense, Docker images generally don&rsquo;t need an init system. So I had to find a method to get one in.</p>
<p>Fortunately, Vault Docker image is built from Alpine Linux and the <a href="https://github.com/firecracker-microvm/firecracker/blob/master/docs/rootfs-and-kernel-setup.md#creating-a-rootfs-image" target="_blank" rel="noopener">Creating a rootfs Image</a> instructions show how to add an init system to a file system of an Alpine based container.</p>
<p>We&rsquo;ve building a file system for Vault:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">FS</span><span class="o">=</span>vault
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Create a file system file and format it as <code>ext4</code>:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">rm /firecracker/filesystems/vault-root.ext4
</span></span><span class="line"><span class="cl">dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/firecracker/filesystems/vault-root.ext4 <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">count</span><span class="o">=</span><span class="m">500</span>
</span></span><span class="line"><span class="cl">mkfs.ext4 /firecracker/filesystems/vault-root.ext4
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>I have no idea how much space I needed. <code>50</code> megs wasn&rsquo;t enough so I gave it <code>500</code> instead.</p>
<p>Create a mount directory and mount the file system file:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">mkdir -p /firecracker/filesystems/mnt-<span class="si">${</span><span class="nv">FS</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">sudo mount /firecracker/filesystems/<span class="si">${</span><span class="nv">FS</span><span class="si">}</span>-root.ext4 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  /firecracker/filesystems/mnt-<span class="si">${</span><span class="nv">FS</span><span class="si">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Now, run the Vault container and fetch the container ID, attach file system mount directory to the container:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CONTAINER_ID</span><span class="o">=</span><span class="k">$(</span>docker run -t --rm -v /firecracker/filesystems/mnt-<span class="si">${</span><span class="nv">FS</span><span class="si">}</span>:/export-rootfs -d vault:latest<span class="k">)</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Get the shell in the container:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker <span class="nb">exec</span> -ti <span class="si">${</span><span class="nv">CONTAINER_ID</span><span class="si">}</span> /bin/sh
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Now, in the container shell, execute these commands:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># install the init system and some extra tools:</span>
</span></span><span class="line"><span class="cl">apk add openrc
</span></span><span class="line"><span class="cl">apk add util-linux
</span></span><span class="line"><span class="cl"><span class="c1"># set up a login terminal on the serial console (ttyS0):</span>
</span></span><span class="line"><span class="cl">ln -s agetty /etc/init.d/agetty.ttyS0
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> ttyS0 &gt; /etc/securetty
</span></span><span class="line"><span class="cl">rc-update add agetty.ttyS0 default
</span></span><span class="line"><span class="cl"><span class="c1"># Make sure special file systems are mounted on boot:</span>
</span></span><span class="line"><span class="cl">rc-update add devfs boot
</span></span><span class="line"><span class="cl">rc-update add procfs boot
</span></span><span class="line"><span class="cl">rc-update add sysfs boot
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># EXTRA: I had to add these lines:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 1. enable local services:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://wiki.gentoo.org/wiki//etc/local.d</span>
</span></span><span class="line"><span class="cl">rc-update add <span class="nb">local</span> default
</span></span><span class="line"><span class="cl"><span class="c1"># 2. create a local service to Start Vault dev server on system boot:</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;#!/bin/sh&#34;</span> &gt;&gt; /etc/local.d/HashiCorpVault.start
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;/usr/local/bin/docker-entrypoint.sh server -dev &amp;&amp; reboot || reboot&#34;</span> &gt;&gt; /etc/local.d/HashiCorpVault.start
</span></span><span class="line"><span class="cl"><span class="c1"># 3. make it executable:</span>
</span></span><span class="line"><span class="cl">chmod +x /etc/local.d/HashiCorpVault.start
</span></span><span class="line"><span class="cl"><span class="c1"># 4. For convenience, enable output from local service so I can see errors:</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">rc_verbose</span><span class="o">=</span>yes &gt; /etc/conf.d/local
</span></span><span class="line"><span class="cl"><span class="c1"># 5. make sure I also have /home and /vault directories in my exported file system</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> d in home vault<span class="p">;</span> <span class="k">do</span> tar c <span class="s2">&#34;/</span><span class="nv">$d</span><span class="s2">&#34;</span> <span class="p">|</span> tar x -C /export-rootfs<span class="p">;</span> <span class="k">done</span>
</span></span><span class="line"><span class="cl"><span class="c1"># EXTRA / end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Then, copy the newly configured system to the rootfs image:</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> d in bin etc lib root sbin usr<span class="p">;</span> <span class="k">do</span> tar c <span class="s2">&#34;/</span><span class="nv">$d</span><span class="s2">&#34;</span> <span class="p">|</span> tar x -C /export-rootfs<span class="p">;</span> <span class="k">done</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> dir in dev proc run sys var<span class="p">;</span> <span class="k">do</span> mkdir /export-rootfs/<span class="si">${</span><span class="nv">dir</span><span class="si">}</span><span class="p">;</span> <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># All done, exit docker shell</span>
</span></span><span class="line"><span class="cl"><span class="nb">exit</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>A few words about the <code>HashiCorpVault.start</code> service file. One method to shut the Firecracker VM gracefully down is to call <code>reboot</code> from inside of the VM. This is because Firecracker exits on CPU reset, <a href="https://github.com/firecracker-microvm/firecracker/blob/master/docs/api_requests/actions.md#intel-and-amd-only-sendctrlaltdel" target="_blank" rel="noopener">more info here</a>. Hence the command:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">/usr/local/bin/docker-entrypoint.sh server -dev <span class="o">&amp;&amp;</span> reboot <span class="o">||</span> reboot
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>will start the Vault server using the regular <code>docker-entrypoint.sh</code> from the original image.</p>
<p>The <code>&amp;&amp; reboot</code> part will ensure the VM stops automatically after Vault exits gracefully. The <code>|| reboot</code> part will stop the VM if Vault does not start for whatever reason.</p>
<p>This saves a hassle of doing <code>ps -a</code> and <code>sudo kill &lt;pid&gt;</code> dance when things go south.</p>
<p>You can now stop the container and unmount the file system:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker stop <span class="si">${</span><span class="nv">CONTAINER_ID</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">sudo umount /firecracker/filesystems/mnt-<span class="si">${</span><span class="nv">FS</span><span class="si">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h2 id="launch-vault-on-firecracker"><a href="#launch-vault-on-firecracker" class="anchor-link">§</a>Launch Vault on Firecracker</h2>
<p>Firecracker VMs can, by design, only use Linux tap devices for networking. There are tools that create ad-hoc devices using CNI plugins but I went with the method from Julia Evans. So, this part is directly lifted from Julia Evans.</p>
<p>Prepare kernel boot args:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">MASK_LONG</span><span class="o">=</span><span class="s2">&#34;255.255.255.252&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">FC_IP</span><span class="o">=</span><span class="s2">&#34;169.254.0.21&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">TAP_IP</span><span class="o">=</span><span class="s2">&#34;169.254.0.22&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">KERNEL_BOOT_ARGS</span><span class="o">=</span><span class="s2">&#34;ro console=ttyS0 noapic reboot=k panic=1 pci=off nomodules random.trust_cpu=on&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">KERNEL_BOOT_ARGS</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">KERNEL_BOOT_ARGS</span><span class="si">}</span><span class="s2"> ip=</span><span class="si">${</span><span class="nv">FC_IP</span><span class="si">}</span><span class="s2">::</span><span class="si">${</span><span class="nv">TAP_IP</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">MASK_LONG</span><span class="si">}</span><span class="s2">::eth0:off&#34;</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Setup tap network interface:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">TAP_DEV</span><span class="o">=</span><span class="s2">&#34;fc-88-tap0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">MASK_SHORT</span><span class="o">=</span><span class="s2">&#34;/30&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">FC_MAC</span><span class="o">=</span><span class="s2">&#34;02:FC:00:00:00:05&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo ip link del <span class="s2">&#34;</span><span class="nv">$TAP_DEV</span><span class="s2">&#34;</span> 2&gt; /dev/null <span class="o">||</span> <span class="nb">true</span>
</span></span><span class="line"><span class="cl">sudo ip tuntap add dev <span class="s2">&#34;</span><span class="nv">$TAP_DEV</span><span class="s2">&#34;</span> mode tap
</span></span><span class="line"><span class="cl">sudo sysctl -w net.ipv4.conf.<span class="si">${</span><span class="nv">TAP_DEV</span><span class="si">}</span>.proxy_arp<span class="o">=</span><span class="m">1</span> &gt; /dev/null
</span></span><span class="line"><span class="cl">sudo sysctl -w net.ipv6.conf.<span class="si">${</span><span class="nv">TAP_DEV</span><span class="si">}</span>.disable_ipv6<span class="o">=</span><span class="m">1</span> &gt; /dev/null
</span></span><span class="line"><span class="cl">sudo ip addr add <span class="s2">&#34;</span><span class="si">${</span><span class="nv">TAP_IP</span><span class="si">}${</span><span class="nv">MASK_SHORT</span><span class="si">}</span><span class="s2">&#34;</span> dev <span class="s2">&#34;</span><span class="nv">$TAP_DEV</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">sudo ip link <span class="nb">set</span> dev <span class="s2">&#34;</span><span class="nv">$TAP_DEV</span><span class="s2">&#34;</span> up
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Write the VM config:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">cat <span class="s">&lt;&lt;EOF &gt; /firecracker/configs/vault-config.json
</span></span></span><span class="line"><span class="cl"><span class="s">{
</span></span></span><span class="line"><span class="cl"><span class="s">  &#34;boot-source&#34;: {
</span></span></span><span class="line"><span class="cl"><span class="s">    &#34;kernel_image_path&#34;: &#34;/firecracker/kernels/vmlinux-${KERNEL_VERSION}&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">    &#34;boot_args&#34;: &#34;$KERNEL_BOOT_ARGS&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  },
</span></span></span><span class="line"><span class="cl"><span class="s">  &#34;drives&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="s">    {
</span></span></span><span class="line"><span class="cl"><span class="s">      &#34;drive_id&#34;: &#34;rootfs&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">      &#34;path_on_host&#34;: &#34;/firecracker/filesystems/${FS}-root.ext4&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">      &#34;is_root_device&#34;: true,
</span></span></span><span class="line"><span class="cl"><span class="s">      &#34;is_read_only&#34;: false
</span></span></span><span class="line"><span class="cl"><span class="s">    }
</span></span></span><span class="line"><span class="cl"><span class="s">  ],
</span></span></span><span class="line"><span class="cl"><span class="s">  &#34;network-interfaces&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="s">      {
</span></span></span><span class="line"><span class="cl"><span class="s">          &#34;iface_id&#34;: &#34;eth0&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">          &#34;guest_mac&#34;: &#34;${FC_MAC}&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">          &#34;host_dev_name&#34;: &#34;${TAP_DEV}&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">      }
</span></span></span><span class="line"><span class="cl"><span class="s">  ],
</span></span></span><span class="line"><span class="cl"><span class="s">  &#34;machine-config&#34;: {
</span></span></span><span class="line"><span class="cl"><span class="s">    &#34;vcpu_count&#34;: 1,
</span></span></span><span class="line"><span class="cl"><span class="s">    &#34;mem_size_mib&#34;: 128,
</span></span></span><span class="line"><span class="cl"><span class="s">    &#34;ht_enabled&#34;: false
</span></span></span><span class="line"><span class="cl"><span class="s">  }
</span></span></span><span class="line"><span class="cl"><span class="s">}
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>And launch:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">firecracker --no-api --config-file /firecracker/configs/vault-config.json
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>The result will be similar to:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>    0.000000<span class="o">]</span> Linux version 5.8.0 <span class="o">(</span>radek@r720sas<span class="o">)</span> <span class="o">(</span>gcc <span class="o">(</span>Ubuntu 7.5.0-3ubuntu1~18.04<span class="o">)</span> 7.5.0, GNU ld <span class="o">(</span>GNU Binutils <span class="k">for</span> Ubuntu<span class="o">)</span> 2.30<span class="o">)</span> <span class="c1">#4 SMP Sat Feb 6 18:50:30 UTC 2021</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>    0.000000<span class="o">]</span> Command line: ro <span class="nv">console</span><span class="o">=</span>ttyS0 noapic <span class="nv">reboot</span><span class="o">=</span>k <span class="nv">panic</span><span class="o">=</span><span class="m">1</span> <span class="nv">pci</span><span class="o">=</span>off nomodules random.trust_cpu<span class="o">=</span>on <span class="nv">ip</span><span class="o">=</span>169.254.0.21::169.254.0.22:255.255.255.252::eth0:off <span class="nv">root</span><span class="o">=</span>/dev/vda rw virtio_mmio.device<span class="o">=</span>4K@0xd0000000:5 virtio_mmio.device<span class="o">=</span>4K@0xd0001000:6
</span></span><span class="line"><span class="cl"><span class="o">[</span>    0.000000<span class="o">]</span> x86/fpu: Supporting XSAVE feature 0x001: <span class="s1">&#39;x87 floating point registers&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>    0.000000<span class="o">]</span> x86/fpu: Supporting XSAVE feature 0x002: <span class="s1">&#39;SSE registers&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>    0.000000<span class="o">]</span> x86/fpu: Supporting XSAVE feature 0x004: <span class="s1">&#39;AVX registers&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>    0.000000<span class="o">]</span> x86/fpu: xstate_offset<span class="o">[</span>2<span class="o">]</span>:  576, xstate_sizes<span class="o">[</span>2<span class="o">]</span>:  <span class="m">256</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>    0.000000<span class="o">]</span> x86/fpu: Enabled xstate features 0x7, context size is <span class="m">832</span> bytes, using <span class="s1">&#39;standard&#39;</span> format.
</span></span><span class="line"><span class="cl"><span class="o">[</span>    0.000000<span class="o">]</span> BIOS-provided physical RAM map:
</span></span><span class="line"><span class="cl"><span class="o">[</span>    0.000000<span class="o">]</span> BIOS-e820: <span class="o">[</span>mem 0x0000000000000000-0x000000000009fbff<span class="o">]</span> usable
</span></span><span class="line"><span class="cl"><span class="o">[</span>    0.000000<span class="o">]</span> BIOS-e820: <span class="o">[</span>mem 0x0000000000100000-0x0000000007ffffff<span class="o">]</span> usable
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl"> * Mounting persistent storage <span class="o">(</span>pstore<span class="o">)</span> filesystem ... <span class="o">[</span> ok <span class="o">]</span>
</span></span><span class="line"><span class="cl"> * Starting <span class="nb">local</span> ... *   Executing <span class="s2">&#34;/etc/local.d/HashiCorpVault.start&#34;</span> ...<span class="o">==</span>&gt; Vault server configuration:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">             Api Address: http://0.0.0.0:8200
</span></span><span class="line"><span class="cl">                     Cgo: disabled
</span></span><span class="line"><span class="cl">         Cluster Address: https://0.0.0.0:8201
</span></span><span class="line"><span class="cl">              Go Version: go1.15.7
</span></span><span class="line"><span class="cl">              Listener 1: tcp <span class="o">(</span>addr: <span class="s2">&#34;0.0.0.0:8200&#34;</span>, cluster address: <span class="s2">&#34;0.0.0.0:8201&#34;</span>, max_request_duration: <span class="s2">&#34;1m30s&#34;</span>, max_request_size: <span class="s2">&#34;33554432&#34;</span>, tls: <span class="s2">&#34;disabled&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">               Log Level: info
</span></span><span class="line"><span class="cl">                   Mlock: supported: true, enabled: <span class="nb">false</span>
</span></span><span class="line"><span class="cl">           Recovery Mode: <span class="nb">false</span>
</span></span><span class="line"><span class="cl">                 Storage: inmem
</span></span><span class="line"><span class="cl">                 Version: Vault v1.6.2
</span></span><span class="line"><span class="cl">             Version Sha: <span class="nv">be65a227ef2e80f8588b3b13584b5c0d9238c1d7</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; Vault server started! Log data will stream in below:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2021-02-06T21:13:22.006Z <span class="o">[</span>INFO<span class="o">]</span>  proxy environment: <span class="nv">http_proxy</span><span class="o">=</span> <span class="nv">https_proxy</span><span class="o">=</span> <span class="nv">no_proxy</span><span class="o">=</span>
</span></span><span class="line"><span class="cl">2021-02-06T21:13:22.007Z <span class="o">[</span>WARN<span class="o">]</span>  no <span class="sb">`</span>api_addr<span class="sb">`</span> value specified in config or in VAULT_API_ADDR<span class="p">;</span> falling back to detection <span class="k">if</span> possible, but this value should be manually <span class="nb">set</span>
</span></span><span class="line"><span class="cl">2021-02-06T21:13:22.020Z <span class="o">[</span>INFO<span class="o">]</span>  core: security barrier not initialized
</span></span><span class="line"><span class="cl">2021-02-06T21:13:22.020Z <span class="o">[</span>INFO<span class="o">]</span>  core: security barrier initialized: <span class="nv">stored</span><span class="o">=</span><span class="m">1</span> <span class="nv">shares</span><span class="o">=</span><span class="m">1</span> <span class="nv">threshold</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">and starts unsealed with a single unseal key. The root token is already
</span></span><span class="line"><span class="cl">authenticated to the CLI, so you can immediately begin using Vault.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">You may need to <span class="nb">set</span> the following environment variable:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    $ <span class="nb">export</span> <span class="nv">VAULT_ADDR</span><span class="o">=</span><span class="s1">&#39;http://0.0.0.0:8200&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">The unseal key and root token are displayed below in <span class="k">case</span> you want to
</span></span><span class="line"><span class="cl">seal/unseal the Vault or re-authenticate.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Unseal Key: YqKuQlzPiMUQXphehp0M7DAvsqImqNJrvJqAn/R0nyc<span class="o">=</span>
</span></span><span class="line"><span class="cl">Root Token: s.F4erraVTvHnx3oU4Ac8zwaCP
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Development mode should NOT be used in production installations!
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Try it out by opening another terminal on the same machine and running:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">curl http://169.254.0.21:8200/sys/health
</span></span><span class="line"><span class="cl"><span class="o">{</span><span class="s2">&#34;errors&#34;</span>:<span class="o">[]}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>It&rsquo;s alive.</p>
<p>You can stop the VM by simply pressing <code>CTRL+C</code> in the terminal window where Vault is running. The VM will shut gracefully down:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">^C<span class="o">==</span>&gt; Vault shutdown triggered
</span></span><span class="line"><span class="cl">2021-02-06T21:13:33.863Z <span class="o">[</span>INFO<span class="o">]</span>  core: marked as sealed
</span></span><span class="line"><span class="cl">2021-02-06T21:13:33.866Z <span class="o">[</span>INFO<span class="o">]</span>  core: pre-seal teardown starting
</span></span><span class="line"><span class="cl">2021-02-06T21:13:33.869Z <span class="o">[</span>INFO<span class="o">]</span>  rollback: stopping rollback manager
</span></span><span class="line"><span class="cl">2021-02-06T21:13:33.872Z <span class="o">[</span>INFO<span class="o">]</span>  core: pre-seal teardown <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">2021-02-06T21:13:33.873Z <span class="o">[</span>INFO<span class="o">]</span>  core: stopping cluster listeners
</span></span><span class="line"><span class="cl">2021-02-06T21:13:33.874Z <span class="o">[</span>INFO<span class="o">]</span>  core.cluster-listener: forwarding rpc listeners stopped
</span></span><span class="line"><span class="cl">2021-02-06T21:13:34.076Z <span class="o">[</span>INFO<span class="o">]</span>  core.cluster-listener: rpc listeners successfully shut down
</span></span><span class="line"><span class="cl">2021-02-06T21:13:34.082Z <span class="o">[</span>INFO<span class="o">]</span>  core: cluster listeners successfully shut down
</span></span><span class="line"><span class="cl">2021-02-06T21:13:34.085Z <span class="o">[</span>INFO<span class="o">]</span>  core: vault is sealed
</span></span><span class="line"><span class="cl"> <span class="o">[</span> ok <span class="o">]</span>
</span></span><span class="line"><span class="cl"> <span class="o">[</span> ok <span class="o">]</span>
</span></span><span class="line"><span class="cl"> * Stopping <span class="nb">local</span> ... <span class="o">[</span> ok <span class="o">]</span>
</span></span><span class="line"><span class="cl">The system is going down NOW!
</span></span><span class="line"><span class="cl">Sent SIGTERM to all processes
</span></span><span class="line"><span class="cl">Sent SIGKILL to all processes
</span></span><span class="line"><span class="cl">Requesting system reboot
</span></span><span class="line"><span class="cl"><span class="o">[</span>   15.877742<span class="o">]</span> Unregister pv shared memory <span class="k">for</span> cpu <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>   15.880260<span class="o">]</span> reboot: Restarting system
</span></span><span class="line"><span class="cl"><span class="o">[</span>   15.881627<span class="o">]</span> reboot: machine restart
</span></span><span class="line"><span class="cl">radek@r720:/firecracker$
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>That&rsquo;s all for today.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://github.com/firecracker-microvm/firecracker" target="_blank" rel="noopener">Firecracker on GitHub</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" class="icon footnote-icon"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg></a></p>
</li>
<li id="fn:2">
<p><a href="https://jvns.ca/blog/2021/01/23/firecracker--start-a-vm-in-less-than-a-second/" target="_blank" rel="noopener">Firecracker: start a VM in less than a second</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" class="icon footnote-icon"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg></a></p>
</li>
<li id="fn:3">
<p><a href="https://github.com/radekg/firecracker-hashicorp-vault" target="_blank" rel="noopener">Complementary GitHub repository</a>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" class="icon footnote-icon"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg></a></p>
</li>
</ol>
</div>

            </div>

            
    
    
        <ul class="post-copyright">
            <li class="copyright-item author"><span class="copyright-item-text">Author</span>: <a href="https://io-oi.me/" class="p-author h-card" target="_blank" rel="noopener">radek gruchalski</a></li>
            
                
                
                
                
                <li class="copyright-item link"><span class="copyright-item-text">Link</span>: <a href="/posts/2021-02-06-taking-firecracker-for-a-spin/" target="_blank" rel="noopener">https://gruchalski.com/posts/2021-02-06-taking-firecracker-for-a-spin/</a></li>
            
            <li class="copyright-item license"><span class="copyright-item-text">License</span>: <a href="https://en.wikipedia.org/wiki/Canonical_link_element" target="_blank" rel="noopener">reposting requires attribution, <strong>use canonical links</strong> »</a></li>
            
        </ul>
    



        </article>

        

        


        


        <div class="post-share">

        

        <div class="share-items">

            
                <div class="share-item twitter">
                    
                    <a href="https://twitter.com/share?url=https://gruchalski.com/posts/2021-02-06-taking-firecracker-for-a-spin/&amp;text=Taking%20Firecracker%20for%20a%20spin&amp;hashtags=firecracker,microvm,vault,&amp;via=%25!s%28%3cnil%3e%29" title="Share on Twitter" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon twitter-icon"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a>
                </div>
            

            

            
                <div class="share-item linkedin">
                    
                    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://gruchalski.com/posts/2021-02-06-taking-firecracker-for-a-spin/&amp;title=Taking%20Firecracker%20for%20a%20spin&amp;summary=Doing%20semi-meaningful%20things%20with%20Firecracker&amp;source=gruchalski.com" title="Share on LinkedIn" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon linkedin-icon"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg></a>
                </div>
            

            

            

            

            

            

            
                <div class="share-item qrcode">
                    <div class="qrcode-container" title="Share via QR Code"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon qrcode-icon"><path d="M0 224h192V32H0v192zM64 96h64v64H64V96zm192-64v192h192V32H256zm128 128h-64V96h64v64zM0 480h192V288H0v192zm64-128h64v64H64v-64zm352-64h32v128h-96v-32h-32v96h-64V288h96v32h64v-32zm0 160h32v32h-32v-32zm-64 0h32v32h-32v-32z"/></svg><div id="qrcode-img"></div>
                    </div>
                    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>

<script>
    var typeNumber = 0;
    var errorCorrectionLevel = 'L';
    var qr = qrcode(typeNumber, errorCorrectionLevel);
    qr.addData('https:\/\/gruchalski.com\/posts\/2021-02-06-taking-firecracker-for-a-spin\/');
    qr.make();
    document.getElementById('qrcode-img').innerHTML = qr.createImgTag();
</script>

                </div>
            

        </div>

    </div>




        
    
    
        <div class="related-posts">
            <h2 class="related-title">See Also:<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon related-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92h-92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"/></svg></h2>
            <ul class="related-list">
                
                    <li class="related-item">
                        <a href="/posts/2021-02-07-vault-on-firecracker-with-cni-plugins-and-nomad/" class="related-link">Vault on Firecracker with CNI plugins and Nomad</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/2021-04-14-launching-consul-cluster-with-firebuild/" class="related-link">Launching Consul cluster with firebuild and other news</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/2021-03-23-introducing-firebuild/" class="related-link">Introducing firebuild</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/2021-03-03-thoughts-on-creating-vmms-from-docker-images/" class="related-link">Thoughts on creating VMMs from Docker images</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/2021-02-19-the-jailer/" class="related-link">The jailer</a>
                    </li>
                
            </ul>
        </div>
    



        
    
        <div class="post-tags">
            
                
                
                
                
                    
                    <a href="/tags/firecracker/" rel="tag" class="post-tags-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>firecracker</a>
                
            
                
                
                
                
                    
                    <a href="/tags/microvm/" rel="tag" class="post-tags-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>microvm</a>
                
            
                
                
                
                
                    
                    <a href="/tags/vault/" rel="tag" class="post-tags-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>vault</a>
                
            
        </div>
    



        


        


        
    
        
        
    
    
    
    
        <ul class="post-nav">
            
                <li class="post-nav-prev">
                    <a href="/posts/2021-02-07-vault-on-firecracker-with-cni-plugins-and-nomad/" rel="prev">&lt; Vault on Firecracker with CNI plugins and Nomad</a>
                </li>
            
            
                <li class="post-nav-next">
                    <a href="/posts/2020-09-16-keycloak-authorization-services-rpt-permissions-or-a-decision-only/" rel="next">Keycloak Authorization Services - RPT, permissions or a decision only &gt;</a>
                </li>
            
        </ul>
    



        


    </div>
</main>


            
    <div id="back-to-top" class="back-to-top">
        <a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a>
    </div>


            
    <footer id="footer" class="footer">
        <div class="footer-inner">
            <div class="site-info">©&nbsp;2015–2023&nbsp;<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon footer-icon"><path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"/></svg>&nbsp;radek gruchalski</div><div class="powered-by">Powered by <a href="https://github.com/gohugoio/hugo" target="_blank" rel="noopener">Hugo</a> | Theme is <a href="https://github.com/reuixiy/hugo-theme-meme" target="_blank" rel="noopener">MemE</a></div><div class="site-copyright"><a href="https://en.wikipedia.org/wiki/Canonical_link_element" target="_blank" rel="noopener">reposting requires attribution, <strong>use canonical links</strong> »</a></div>

            
    
        <ul class="socials"><li class="socials-item">
                    <a href="/rss.xml" target="_blank" rel="external noopener" title="RSS"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon social-icon"><path d="M19.199 24C19.199 13.467 10.533 4.8 0 4.8V0c13.165 0 24 10.835 24 24h-4.801zM3.291 17.415c1.814 0 3.293 1.479 3.293 3.295 0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526 0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727 0 15.909 7.184 15.909 15.91z"/></svg></a>
                </li><li class="socials-item">
                    <a href="mailto:radek@gruchalski.com" target="_blank" rel="external noopener" title="Email"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon social-icon"><path d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"/></svg></a>
                </li><li class="socials-item">
                    <a href="https://github.com/radekg" target="_blank" rel="external noopener" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon social-icon"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
                </li><li class="socials-item">
                    <a href="https://linkedin.com/in/radgruchalski" target="_blank" rel="external noopener" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon social-icon"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg></a>
                </li></ul>
    



            
        </div>
    </footer>


        </div>
        

        








    <script src="https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js"></script>

<script>
    mediumZoom(document.querySelectorAll('div.post-body img'), {
        background: 'hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)'
    })
</script>




    <script src="https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js" type="module" defer></script>







    </body>
</html>
