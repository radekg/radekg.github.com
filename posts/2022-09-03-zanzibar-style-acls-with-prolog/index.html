<!DOCTYPE html>
<html lang="en">
    <head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
    <meta charset="UTF-8" />

    <meta name="generator" content="Hugo 0.115.1"><meta name="theme-color" content="#fff" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <meta name="format-detection" content="telephone=no, date=no, address=no, email=no" />
    
    <meta http-equiv="Cache-Control" content="no-transform" />
    
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>Zanzibar-style ACLs with Prolog | gruchalski.com</title>

    <link rel="stylesheet" href="/css/meme.min.fe3b4eabe26125d7716d7271d1dcc928f862e422b39cc80a8c45354f89084434.css"/>

    
    
        <script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js" defer></script><script src="/js/meme.min.1321582b41a9fdb1a15023a3d3204fa013ace575e4c594c9dbc43078a016fce0.js"></script>

    

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

        <link rel="stylesheet" href="/assets/fonts/amaranth.css?family=IBM&#43;Plex&#43;Serif:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;family=Amaranth&amp;display=swap" media="print" onload="this.media='all'" />
        <noscript><link rel="stylesheet" href="/assets/fonts/amaranth.css?family=IBM&#43;Plex&#43;Serif:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;family=Amaranth&amp;display=swap" /></noscript>

    <meta name="author" content="Radek Gruchalski" /><meta name="description" content="Back in May, I looked at an implementation of Zanzibar-style ACLs in Open Policy Agent Rego1.
I’m revisiting that problem while learning Prolog, another language from my never-ending to-learn list. There are some similarities to the previous article, but I’m taking the problem further: I’m adding permissions inheritance from anywhere within the filesystem tree." />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#2a6df4" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="gruchalski.com" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="gruchalski.com" />
    <meta name="msapplication-starturl" content="../../" />
    <meta name="msapplication-TileColor" content="#fff" />
    <meta name="msapplication-TileImage" content="../../icons/mstile-150x150.png" />
    <link rel="manifest" href="/manifest.json" />

    
    

    
    
        <link rel="canonical" href="https://gruchalski.com/posts/2022-09-03-zanzibar-style-acls-with-prolog/" />
    

    

<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "datePublished": "2022-09-03T00:00:00+02:00",
        "dateModified": "2023-07-04T23:40:31+02:00",
        "url": "https://gruchalski.com/posts/2022-09-03-zanzibar-style-acls-with-prolog/",
        "headline": "Zanzibar-style ACLs with Prolog",
        "description": "Back in May, I looked at an implementation of Zanzibar-style ACLs in Open Policy Agent Rego1.\nI’m revisiting that problem while learning Prolog, another language from my never-ending to-learn list. There are some similarities to the previous article, but I’m taking the problem further: I’m adding permissions inheritance from anywhere within the filesystem tree.",
        "inLanguage" : "en",
        "articleSection": "posts",
        "wordCount":  3884 ,
        "image": "https://gruchalski.com/icons/apple-touch-icon.png",
        "author": {
            "@type": "Person",
            "email": "radek@gruchalski.com",
            "image": "https://gruchalski.com/icons/apple-touch-icon.png",
            "url": "https://io-oi.me/",
            "name": "radek gruchalski"
        },
        "license": "[reposting requires attribution, **use canonical links** »](https://en.wikipedia.org/wiki/Canonical_link_element)",
        "publisher": {
            "@type": "Organization",
            "name": "gruchalski.com",
            "logo": {
                "@type": "ImageObject",
                "url": "https://gruchalski.com/icons/apple-touch-icon.png"
            },
            "url": "https://gruchalski.com/"
        },
        "mainEntityOfPage": {
            "@type": "WebSite",
            "@id": "https://gruchalski.com/"
        }
    }
</script>

    

<meta name="twitter:card" content="summary" />


    



<meta property="og:title" content="Zanzibar-style ACLs with Prolog" />
<meta property="og:description" content="Back in May, I looked at an implementation of Zanzibar-style ACLs in Open Policy Agent Rego1.
I’m revisiting that problem while learning Prolog, another language from my never-ending to-learn list. There are some similarities to the previous article, but I’m taking the problem further: I’m adding permissions inheritance from anywhere within the filesystem tree." />
<meta property="og:url" content="https://gruchalski.com/posts/2022-09-03-zanzibar-style-acls-with-prolog/" />
<meta property="og:site_name" content="gruchalski.com" />
<meta property="og:locale" content="en" /><meta property="og:image" content="/assets/posts/2022-09-03/header.png" />
<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2022-09-03T00:00:00&#43;02:00" />
    <meta property="article:modified_time" content="2023-07-04T23:40:31&#43;02:00" />
    
    <meta property="article:section" content="posts" />



    
    

    
</head>

    <body>
        <div class="container">
            
    <header class="header">
        
            <div class="header-wrapper">
                <div class="header-inner single">
                    
    <div class="site-brand">
        
            <a href="/" class="brand">gruchalski.com</a>
        
    </div>

                    <nav class="nav">
    <ul class="menu" id="menu">
        
            
        
        
        
        
            
                <li class="menu-item"><a href="/posts/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon archive"><path d="M32 448c0 17.7 14.3 32 32 32h384c17.7 0 32-14.3 32-32V160H32v288zm160-212c0-6.6 5.4-12 12-12h104c6.6 0 12 5.4 12 12v8c0 6.6-5.4 12-12 12H204c-6.6 0-12-5.4-12-12v-8zM480 32H32C14.3 32 0 46.3 0 64v48c0 8.8 7.2 16 16 16h480c8.8 0 16-7.2 16-16V64c0-17.7-14.3-32-32-32z"/></svg><span class="menu-item-name">posts</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" class="icon code-branch"><path d="M384 144c0-44.2-35.8-80-80-80s-80 35.8-80 80c0 36.4 24.3 67.1 57.5 76.8-.6 16.1-4.2 28.5-11 36.9-15.4 19.2-49.3 22.4-85.2 25.7-28.2 2.6-57.4 5.4-81.3 16.9v-144c32.5-10.2 56-40.5 56-76.3 0-44.2-35.8-80-80-80S0 35.8 0 80c0 35.8 23.5 66.1 56 76.3v199.3C23.5 365.9 0 396.2 0 432c0 44.2 35.8 80 80 80s80-35.8 80-80c0-34-21.2-63.1-51.2-74.6 3.1-5.2 7.8-9.8 14.9-13.4 16.2-8.2 40.4-10.4 66.1-12.8 42.2-3.9 90-8.4 118.2-43.4 14-17.4 21.1-39.8 21.6-67.9 31.6-10.8 54.4-40.7 54.4-75.9zM80 64c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm0 384c-8.8 0-16-7.2-16-16s7.2-16 16-16 16 7.2 16 16-7.2 16-16 16zm224-320c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16z"/></svg><span class="menu-item-name">categories</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/tags/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="icon tags"><path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"/></svg><span class="menu-item-name">tags</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/about/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="icon user-circle"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"/></svg><span class="menu-item-name">about</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/privacy/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512" class="icon info"><path d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"/></svg><span class="menu-item-name">privacy</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href=""></a>
                </li>
            
        
            
                
            
        
    </ul>
</nav>

                    
                </div>
            </div>
            
    <input type="checkbox" id="nav-toggle" aria-hidden="true" />
    <label for="nav-toggle" class="nav-toggle"></label>
    <label for="nav-toggle" class="nav-curtain"></label>


        
    </header>




            
            
    <main class="main single" id="main">
    <div class="main-inner">

        

        <article class="content post h-entry" data-align="default" data-type="posts" data-toc-num="true">

            <h1 class="post-title p-name">Zanzibar-style ACLs with Prolog</h1>

            

            
                
            

            
                

<div class="post-meta">
    
        
        <time datetime="2022-09-03T00:00:00&#43;02:00" class="post-meta-item published dt-published"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"/></svg>&nbsp;September 3, 2022</time>
    
    
    
    
        
        
        
    
    
        
        <span class="post-meta-item wordcount"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;3884</span>
    
    
        
        <span class="post-meta-item reading-time"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;19&nbsp;mins</span>
    
    
    
</div>

            

            
                <img src="/assets/posts/2022-09-03/header.png" alt="thumbnail" class="p-article__thumbnail">
            

            <div class="post-body e-content">
              <p>Back in May, I looked at an implementation of <a href="/posts/2022-05-07-zanzibar-style-acls-with-opa-rego/">Zanzibar-style ACLs in Open Policy Agent Rego</a><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">[1]</a></sup>.</p>
<p>I&rsquo;m revisiting that problem while learning Prolog, another language from my never-ending <em>to-learn list</em>. There are some similarities to the previous article, but I&rsquo;m taking the problem further: I&rsquo;m adding permissions inheritance from anywhere within the filesystem tree.</p>
<div>
    <h2>table of contents</h2>
    <nav id="TableOfContents">
  <ol>
    <li><a href="#the-problem">the problem</a></li>
    <li><a href="#iterating-on-the-problem">iterating on the problem</a></li>
    <li><a href="#the-facts-filesystem">the facts: filesystem</a></li>
    <li><a href="#the-facts-permissions">the facts: permissions</a></li>
    <li><a href="#utilities">utilities</a></li>
    <li><a href="#object-permissions-and-inheritance">object permissions and inheritance</a></li>
    <li><a href="#swi-prolog">SWI-Prolog</a></li>
    <li><a href="#trying-out-object-permissions">trying out object permissions</a></li>
    <li><a href="#explaining-inheritance">explaining inheritance</a>
      <ol>
        <li><a href="#predicate-order">predicate order</a></li>
        <li><a href="#on-unification">on unification</a></li>
      </ol>
    </li>
    <li><a href="#trying-out-inheritance">trying out inheritance</a>
      <ol>
        <li><a href="#tracing-inherits3">tracing <code>inherits/3</code></a></li>
        <li><a href="#tracing-the-curious-case-of-the-predicate-order">tracing: the curious case of the predicate order</a></li>
      </ol>
    </li>
    <li><a href="#querying-file-permissions-directly">querying file permissions directly</a></li>
    <li><a href="#summary">summary</a></li>
    <li><a href="#thoughts-on-prolog">thoughts on Prolog</a></li>
  </ol>
</nav>
</div>
<h2 id="the-problem"><a href="#the-problem" class="anchor-link">§</a>the problem</h2>
<p>In <a href="/posts/2022-05-07-zanzibar-style-acls-with-opa-rego/">Zanzibar-style ACLs with OPA Rego</a><sup id="fnref1:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> I have implemented the ACLs for the canonical example from the Zanzibar whitepaper:</p>
<pre tabindex="0"><code>name: &#34;doc&#34;

relation { name: &#34;owner&#34; }

relation {
  name: &#34;editor&#34;
  userset_rewrite {
    union {
      child { _this {} }
      child { computed_userset { relation: &#34;owner&#34; } }
} } }

relation {
  name: &#34;viewer&#34;
  userset_rewrite {
    union {
      child { _this {} }
      child { computed_userset { relation: &#34;editor&#34; } }
      child { tuple_to_userset {
        tupleset { relation: &#34;parent&#34; }
        computed_userset {
          object: $TUPLE_USERSET_OBJECT # parent folder
          relation: &#34;viewer&#34;
   } } }
} } }
</code></pre><p>It reads like this:</p>
<ul>
<li>A document has owners.</li>
<li>Document owners are also editors.</li>
<li>Document editors are also document viewers.</li>
<li>Furthermore, the viewers of a parent folder are also viewers of the document.</li>
</ul>
<p>The notation I came up with:</p>
<pre tabindex="0"><code>doc:some-doc#viewer@doc:some-doc#editor@doc:some-doc#owner
doc:some-doc#viewer@folder:some-doc-parent-folder#viewer
</code></pre><p>You can find the complete reasoning behind this in the article linked above in this section.</p>
<h2 id="iterating-on-the-problem"><a href="#iterating-on-the-problem" class="anchor-link">§</a>iterating on the problem</h2>
<p>While solving this problem in Prolog, I&rsquo;m going to take this a step further. ACLs can be inherited from any parent directory in the tree, up to the root directory.</p>
<p>Code examples will operate on UUIDs exclusively but in the article, I will be referring to files and directories by their names. The tree used in this example is small, so that it can be easily reasoned about:</p>
<pre tabindex="0"><code>data                           root, a bucket, UUID: 851a7566-b83d-4993-bd04-9b8244091d45
    ├-- a-data-item.png                  file, UUID: 9c57448c-e901-4fd3-a47e-b6ecf0470c5f
    └-- documents                   directory, UUID: b94c1f40-818b-47be-882b-ce1a8fbee254
      ├-- a-document.md                  file, UUID: f666cc22-1e92-457b-b7ee-0f6b48825185
      └-- pdfs                      directory, UUID: 7f916bd9-f324-40f2-97d3-95e7cc7d722e
        ├-- a-file.pdf                   file, UUID: bee100a0-30b1-4184-94aa-3d408b75e938
        └-- another.pdf                  file, UUID: ecf47371-fd08-44f1-9c06-7c970d948ae8
</code></pre><p>A permission can be assigned to a file or directory. A permission assigned to a directory applies to all child directories and files. For example:</p>
<ul>
<li>An <em>editor</em> of <em>data</em> directory can <em>edit</em> and <em>view</em>: <em>a-data-item.png</em>, <em>a-document.md</em>, and <em>a-file.pdf</em>.</li>
<li>A <em>viewer</em> of <em>pdfs</em> can view <em>a-file.pdf</em> only.</li>
<li>A <em>viewer</em> of <em>a-file.pdf</em> can view that file only and no other file inside of the parent directory <em>pdfs</em>.</li>
</ul>
<p>Permissions will be stored outside of filesystem objects and they are optional for an object. An object may or may not have a set of permissions attached. If an object does not have permissions attached, it&rsquo;s okay, they are simply inherited from a directory above.</p>
<h2 id="the-facts-filesystem"><a href="#the-facts-filesystem" class="anchor-link">§</a>the facts: filesystem</h2>
<p>The filesystem is defined using the following facts:</p>
<script type="application/javascript" src="https://gist.github.com/radekg/192ed65e53299bce74f59cfdbabf94ac.js?file=01-filesystem.pl"></script>

<p>A <code>directory</code> fact has three properties:</p>
<ul>
<li>A name.</li>
<li>An object ID.</li>
<li>A parent object ID. The root directory does not have a parent and that fact is encoded by using <code>parent(objectid())</code> with value in <code>objectid()</code>.</li>
</ul>
<p>A document has exactly one parent pointing at a <code>directory</code>.</p>
<h2 id="the-facts-permissions"><a href="#the-facts-permissions" class="anchor-link">§</a>the facts: permissions</h2>
<script type="application/javascript" src="https://gist.github.com/radekg/192ed65e53299bce74f59cfdbabf94ac.js?file=02-permissions.pl"></script>

<p>Permissions are optional for an object hence there are less permissions than a total of directories and documents. A <code>permission</code> fact contains an object ID it attaches to, and a list of permissions.</p>
<p>Permissions are represented as a list of <code>[role₁, [identity₁, ...], ... roleₙ, [identityₙ, ...]]</code>.</p>
<p>From the set of facts, we can deduce the following:</p>
<ul>
<li>Berta is the <em>data</em> <em>owner</em>.</li>
<li>Charlie is an <em>editor</em> of <em>data</em>.</li>
<li>Alan is a viewer of <em>pdfs</em>.</li>
<li>Jake can only view the <em>a-file.pdf</em> file.</li>
</ul>
<h2 id="utilities"><a href="#utilities" class="anchor-link">§</a>utilities</h2>
<p>The program requires a bunch of utilities:</p>
<ol>
<li><code>append(+L1, +L2, -OutList)</code>: appends a list to another list, for example <code>append([a, b], [c, d], -Out) → Out = [a, b, c, d]</code>.</li>
<li><code>in_list(+Atom, +List)</code>: an implementation of <code>member</code>, it checks if an item exists in the list.</li>
<li><code>find_kv(+Atom, +List, -OutList)</code>: given a list of <code>[k₁, v₁, k₂, v₂, ... kₙ, vₙ]</code>, finds <code>vₙ</code> for requested <code>kₙ</code>, returns a default value if nothing found. The program here assumes that <code>vₙ</code> is a list.</li>
</ol>
<p>Here&rsquo;s the code:</p>
<script type="application/javascript" src="https://gist.github.com/radekg/192ed65e53299bce74f59cfdbabf94ac.js?file=03-utilities.pl"></script>

<h2 id="object-permissions-and-inheritance"><a href="#object-permissions-and-inheritance" class="anchor-link">§</a>object permissions and inheritance</h2>
<p>Now, I need a method of fetching object permissions and figuring out inheritance. Here&rsquo;s the strategy:</p>
<ul>
<li>Querying for permissions of an object implies that three facts are known:
<ul>
<li>An <em>ID</em> of the object.</li>
<li>An <em>identity</em>, in this case, a username.</li>
<li>A relation type: <em>viewer</em>, <em>editor</em>, <em>owner</em>.</li>
</ul>
</li>
<li>The problem statement says that an <em>owner</em> is an <em>editor</em>, and an <em>editor</em> is a <em>viewer</em>. What does this mean, logically speaking? Well, it simply means that for a user to be a <em>viewer</em> it doesn&rsquo;t matter if the user is an <em>editor</em> or an <em>owner</em>.</li>
</ul>
<p>Example:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="nf">permissions</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="s">owners</span><span class="p">,</span> <span class="p">[</span><span class="s">berta</span><span class="p">],</span> <span class="s">editors</span><span class="p">,</span> <span class="p">[</span><span class="s">charlie</span><span class="p">]]).</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>The above declares a set of permissions for the <em>data</em> directory (the bucket). It says that Berta belongs to the <em>owners</em> and Charlie is an <em>editor</em>. To find out if Berta is an <em>editor</em>, the program needs to find a list of <em>editors</em> and a list of <em>owners</em>. Two lists have to be combined, the result includes <em>berta</em>, Berta is an <em>editor</em>. Regardless of the actual assigned role is. Finding out which role is actually assigned to Berta would imply another API.</p>
<p>Here&rsquo;s the code:</p>
<script type="application/javascript" src="https://gist.github.com/radekg/192ed65e53299bce74f59cfdbabf94ac.js?file=04-inheritance.pl"></script>

<p>The relevant part is <code>object_permissions(+Id, +Roles, -CombinedRoles)</code>.</p>
<ul>
<li>This predicate recurses on <code>+Roles</code> list, which is given as <code>[role₁, role₂, ... roleₙ]</code>. For each role, the following happens:
<ul>
<li>The program tries to get the permission list for an object ID.</li>
<li>As we said, permissions for an object ID are optional, hence we have a guarding <code>object_permissions(_, _, []).</code>.
<ul>
<li>If there are no permissions for an ID, return an empty list.</li>
</ul>
</li>
<li>If permissions for the ID exist, call <code>find_kv(+Role, +Permissions, -RolePermissions)</code>.</li>
<li>Recurse on the <code>+RoleTail</code>.</li>
<li>Whatever comes back from <code>find_kv</code> under <code>-RolePermissions</code> gets appended to the accumulator <code>-Out</code>.</li>
</ul>
</li>
</ul>
<p>Let&rsquo;s load it all up in Prolog and see it in action.</p>
<h2 id="swi-prolog"><a href="#swi-prolog" class="anchor-link">§</a>SWI-Prolog</h2>
<p>By far the easiest way to start with Prolog is SWI-Prolog. To install SWI-Prolog:</p>
<ul>
<li>On macOS: <code>brew install swi-prolog</code>.</li>
<li>On Debian-based Linux: <code>sudo apt-get install swi-prolog -y</code>.</li>
</ul>
<p>The installation will take a bit but when finished, SWI-Prolog can be started from the terminal by executing <code>swipl</code> command.</p>
<h2 id="trying-out-object-permissions"><a href="#trying-out-object-permissions" class="anchor-link">§</a>trying out object permissions</h2>
<p>Okay, we have Prolog available. Let&rsquo;s set up a workspace and try out those permissions.</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">mkdir -p /tmp/zanzibar
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> /tmp/zanzibar
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">site</span><span class="o">=</span><span class="s2">&#34;https://gist.githubusercontent.com&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">gist</span><span class="o">=</span>15bc4c9ea6a9be11a63c79c4b9d392537bfbe03a
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">base_url</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">site</span><span class="si">}</span><span class="s2">/radekg/192ed65e53299bce74f59cfdbabf94ac/raw/</span><span class="si">${</span><span class="nv">gist</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">wget -O 01-filesystem.pl <span class="s2">&#34;</span><span class="si">${</span><span class="nv">base_url</span><span class="si">}</span><span class="s2">/01-filesystem.pl&#34;</span>
</span></span><span class="line"><span class="cl">wget -O 02-permissions.pl <span class="s2">&#34;</span><span class="si">${</span><span class="nv">base_url</span><span class="si">}</span><span class="s2">/02-permissions.pl&#34;</span>
</span></span><span class="line"><span class="cl">wget -O 03-utilities.pl <span class="s2">&#34;</span><span class="si">${</span><span class="nv">base_url</span><span class="si">}</span><span class="s2">/03-utilities.pl&#34;</span>
</span></span><span class="line"><span class="cl">wget -O 04-inheritance.pl <span class="s2">&#34;</span><span class="si">${</span><span class="nv">base_url</span><span class="si">}</span><span class="s2">/04-inheritance.pl&#34;</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Start <em>swipl</em>:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">swipl
</span></span></code></pre></td></tr></table></div>
</div>
</div><pre tabindex="0"><code>Welcome to SWI-Prolog (threaded, 64 bits, version 8.4.3)
SWI-Prolog comes with ABSOLUTELY NO WARRANTY. This is free software.
Please run ?- license. for legal details.

For online help and background, visit https://www.swi-prolog.org
For built-in help, use ?- help(Topic). or ?- apropos(Word).

?- 
</code></pre><p>Load all 4 files:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="s">?-</span> <span class="p">[</span><span class="s2">&#34;01-filesystem.pl&#34;</span><span class="p">,</span> <span class="s2">&#34;02-permissions.pl&#34;</span><span class="p">,</span> <span class="s2">&#34;03-utilities.pl&#34;</span><span class="p">,</span> <span class="s2">&#34;04-inheritance.pl&#34;</span><span class="p">].</span>
</span></span><span class="line"><span class="cl"><span class="s">true</span><span class="p">.</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>So, let&rsquo;s get a list of all permitted <em>owners</em>, <em>editors</em>, and <em>viewers</em> for object <em>851a7566-b83d-4993-bd04-9b8244091d45</em>.</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">object_permissions</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">owners</span><span class="p">,</span> <span class="s">editors</span><span class="p">,</span> <span class="s">viewers</span><span class="p">],</span> <span class="nv">Out</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"><span class="nv">Out</span> <span class="o">=</span> <span class="p">[</span><span class="s">berta</span><span class="p">,</span> <span class="s">charlie</span><span class="p">]</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Now, <em>owners</em> only:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">object_permissions</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">owners</span><span class="p">],</span> <span class="nv">Out</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"><span class="nv">Out</span> <span class="o">=</span> <span class="p">[</span><span class="s">berta</span><span class="p">]</span> <span class="p">.</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p><strong>Note</strong>: You will have to type the final <em>dot</em> after receiving the answer to come back to the Prolog <code>?-</code> shell.</p>
<p>Awesome, so this shows has to retrieve a combined list of users allowed to access an object at an expected level. The role list containing multiple roles, for example <code>[owners, editors, viewers]</code> is a very simple method of saying that <code>all owners belong to a set of owners+editors+viewers</code>.</p>
<p><strong>Note2</strong>: To quit <em>swipl</em> back to the terminal shell, press CTRL+D.</p>
<p>Let&rsquo;s move on to the inheritance.</p>
<h2 id="explaining-inheritance"><a href="#explaining-inheritance" class="anchor-link">§</a>explaining inheritance</h2>
<p>Let&rsquo;s recap: given a file ID, the program will traverse the parents up to the root directory (the bucket). To solve this question, the following facts need to be known:</p>
<ul>
<li>The object ID for which we want to know if the user has the required permission.</li>
<li>The required access level.</li>
<li>The identity.</li>
</ul>
<p>The traversal must continue only until:</p>
<ul>
<li>The root has been reached.</li>
<li>Or until the user has been found in any inspected permission for the first time.</li>
<li>If the user has been found to have permission before reaching the root, there is no point in traversing all the way to the root anymore.</li>
</ul>
<p>This process is implemented in the recursive <code>inherits/3</code> predicate. This predicate recurses over parent directories. There are three variants of this predicate defined:</p>
<ol>
<li>When reaching a root (above the root of the bucket), there is nothing else to do, if the user isn&rsquo;t found to be in a role until now, they are not allowed to perform the requested role:</li>
</ol>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(),</span> <span class="k">_</span><span class="p">,</span> <span class="k">_</span><span class="p">)</span> <span class="p">:-</span> <span class="s">false</span><span class="p">.</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><ol start="2">
<li>When permissions returned from <code>optional_object_permissions/3</code> contain the searched username, return <code>true</code> because the user is found. The recursion stops, thus the traversal stops.</li>
</ol>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="nv">ObjectId</span><span class="p">),</span> <span class="nv">Roles</span><span class="p">,</span> <span class="nv">User</span><span class="p">)</span> <span class="p">:-</span>
</span></span><span class="line"><span class="cl">    <span class="nf">optional_object_permissions</span><span class="p">(</span><span class="nv">ObjectId</span><span class="p">,</span> <span class="nv">Roles</span><span class="p">,</span> <span class="nv">Permissions</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nf">in_list</span><span class="p">(</span><span class="nv">User</span><span class="p">,</span> <span class="nv">Permissions</span><span class="p">).</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><ol start="3">
<li>Otherwise, get the parent directory and recursively call <code>inherits/3</code> for the parent directory.</li>
</ol>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="nv">ObjectId</span><span class="p">),</span> <span class="nv">Roles</span><span class="p">,</span> <span class="nv">User</span><span class="p">)</span> <span class="p">:-</span>
</span></span><span class="line"><span class="cl">    <span class="nf">directory</span><span class="p">(</span><span class="k">_</span><span class="p">,</span> <span class="nf">objectid</span><span class="p">(</span><span class="nv">ObjectId</span><span class="p">),</span> <span class="nf">parent</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="nv">ParentObjectId</span><span class="p">))),</span>
</span></span><span class="line"><span class="cl">    <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="nv">ParentObjectId</span><span class="p">),</span> <span class="nv">Roles</span><span class="p">,</span> <span class="nv">User</span><span class="p">).</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h3 id="predicate-order"><a href="#predicate-order" class="anchor-link">§</a>predicate order</h3>
<p>For this code, it is important to remember that the predicate order in Prolog is significant. The second predicate uses <code>in_list/2</code> to check if the solution has been found, in which case, the recursion gets interrupted. The third predicate does not have a negating <code>\+ in_list/2</code> call so the order is important.</p>
<p>Those three predicates roughly translate to:</p>
<pre tabindex="0"><code>if reached_root
  false
else if user_found in permissions
  true
else
  fetch_parent
  recurse
</code></pre><p>Unlike Datalog—a subset of Prolog—Prolog itself evaluates predicates in order. It will attempt to solve a query with the first occurrence of the predicate, if that predicate returns <code>false</code> at any point, Prolog will retry answering the question with the next defined predicate that can be <em>unified</em>. This process repeats until all <em>unifying</em> predicates have been exhausted, at which point, <code>false</code> is returned. Another major difference between Prolog and Datalog: Datalog programs always terminate, and infinite loops aren&rsquo;t possible while they can happen in Prolog.</p>
<p>I&rsquo;m mentioning Datalog because OPA Rego is a Datalog-inspired language.</p>
<h3 id="on-unification"><a href="#on-unification" class="anchor-link">§</a>on unification</h3>
<p>The in-detail explanation of unification goes beyond this article. I recommend <a href="https://www.javatpoint.com/unification-in-prolog" target="_blank" rel="noopener">the following article to learn more about unification in Prolog</a><sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">[2]</a></sup>.</p>
<blockquote>
<p>Two terms unify if they are the same term or if they contain variables that can be uniformly instantiated with terms in such a way that the resulting terms are equal.</p>
</blockquote>
<h2 id="trying-out-inheritance"><a href="#trying-out-inheritance" class="anchor-link">§</a>trying out inheritance</h2>
<p>Let&rsquo;s see how to find out if the user is allowed to become a certain role using <code>inherits/3</code>.</p>
<p>Is Berta allowed to view <em>a-file.pdf</em> (object ID <em>bee100a0-30b1-4184-94aa-3d408b75e938</em>)? Remember, <em>inherits</em> means exactly that: does the user inherit a role from any parent directory? This means we cannot query directly for a file object ID just yet. So, in this case, we are querying for the parent directory ID: <em>7f916bd9-f324-40f2-97d3-95e7cc7d722e</em>.</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">owners</span><span class="p">,</span> <span class="s">editors</span><span class="p">,</span> <span class="s">viewers</span><span class="p">],</span> <span class="s">berta</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"><span class="s">true</span> <span class="p">.</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>What about Charlie, is he an <em>editor</em>?</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">viewers</span><span class="p">],</span> <span class="s">charlie</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"><span class="s">true</span> <span class="p">.</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>But is he an <em>owner</em>?</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">owners</span><span class="p">],</span> <span class="s">charlie</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"><span class="s">false</span><span class="p">.</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h3 id="tracing-inherits3"><a href="#tracing-inherits3" class="anchor-link">§</a>tracing <code>inherits/3</code></h3>
<p>Let&rsquo;s verify that our <code>inherits/3</code> traverses the directory tree only until the user has been found. We can trace the execution of selected predicates using the built-in <code>trace/1</code> predicate.</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">trace</span><span class="p">(</span><span class="s">inherits</span><span class="o">/</span><span class="mi">3</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"><span class="c1">%         inherits/3: [all]</span>
</span></span><span class="line"><span class="cl"><span class="s">true</span><span class="p">.</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>And retry the query for Berta:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">owners</span><span class="p">,</span> <span class="s">editors</span><span class="p">,</span> <span class="s">viewers</span><span class="p">],</span> <span class="s">berta</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">owners</span><span class="p">,</span> <span class="s">editors</span><span class="p">,</span> <span class="s">viewers</span><span class="p">],</span> <span class="s">berta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">owners</span><span class="p">,</span> <span class="s">editors</span><span class="p">,</span> <span class="s">viewers</span><span class="p">],</span> <span class="s">berta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">28</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">owners</span><span class="p">,</span> <span class="s">editors</span><span class="p">,</span> <span class="s">viewers</span><span class="p">],</span> <span class="s">berta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">28</span><span class="p">]</span> <span class="nv">Exit</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">owners</span><span class="p">,</span> <span class="s">editors</span><span class="p">,</span> <span class="s">viewers</span><span class="p">],</span> <span class="s">berta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="nv">Exit</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">owners</span><span class="p">,</span> <span class="s">editors</span><span class="p">,</span> <span class="s">viewers</span><span class="p">],</span> <span class="s">berta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="nv">Exit</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">owners</span><span class="p">,</span> <span class="s">editors</span><span class="p">,</span> <span class="s">viewers</span><span class="p">],</span> <span class="s">berta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="s">true</span> <span class="p">.</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>We can see that the traversal went all the way up to the top <em>data</em> directory, where Berta&rsquo;s permissions are attached. What about Alan? Alan is a viewer of <em>pdfs</em>. So if we wanted to find out if Alan can view a file inside of that directory, given that his permissions are attached directly to the <em>pdfs</em> directory, we should not see a full traversal to the root. Is that the case?</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">viewers</span><span class="p">],</span> <span class="s">alan</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">viewers</span><span class="p">],</span> <span class="s">alan</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="nv">Exit</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">viewers</span><span class="p">],</span> <span class="s">alan</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="s">true</span> <span class="p">.</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Indeed, the traversal finished early. Of course, the side effect of how traversal is implemented is that if we want to know if Alan is an owner of a file in the <em>pdfs</em> directory, we have to traverse all the way up to reach <code>false</code>.</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">owners</span><span class="p">],</span> <span class="s">alan</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">owners</span><span class="p">],</span> <span class="s">alan</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">owners</span><span class="p">],</span> <span class="s">alan</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">28</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">owners</span><span class="p">],</span> <span class="s">alan</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">28</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">owners</span><span class="p">],</span> <span class="s">alan</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">owners</span><span class="p">],</span> <span class="s">alan</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">owners</span><span class="p">],</span> <span class="s">alan</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="s">false</span><span class="p">.</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>This could become a bottleneck if there are many, many nested directories but for now, I&rsquo;m okay with that.</p>
<p>We can disable tracing now:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">trace</span><span class="p">(</span><span class="s">inherits</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="s">all</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"><span class="c1">%         inherits/3: Not tracing</span>
</span></span><span class="line"><span class="cl"><span class="s">true</span><span class="p">.</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h3 id="tracing-the-curious-case-of-the-predicate-order"><a href="#tracing-the-curious-case-of-the-predicate-order" class="anchor-link">§</a>tracing: the curious case of the predicate order</h3>
<p>An interesting trivia regarding the <code>inherits/3</code> predicate. Semantically, these two variants solve the same problem:</p>
<ol>
<li>Variant 1:</li>
</ol>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="nv">ObjectId</span><span class="p">),</span> <span class="nv">Roles</span><span class="p">,</span> <span class="nv">User</span><span class="p">)</span> <span class="p">:-</span>
</span></span><span class="line"><span class="cl">    <span class="nf">optional_object_permissions</span><span class="p">(</span><span class="nv">ObjectId</span><span class="p">,</span> <span class="nv">Roles</span><span class="p">,</span> <span class="nv">Permissions</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nf">in_list</span><span class="p">(</span><span class="nv">User</span><span class="p">,</span> <span class="nv">Permissions</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"><span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="nv">ObjectId</span><span class="p">),</span> <span class="nv">Roles</span><span class="p">,</span> <span class="nv">User</span><span class="p">)</span> <span class="p">:-</span>
</span></span><span class="line"><span class="cl">    <span class="nf">directory</span><span class="p">(</span><span class="k">_</span><span class="p">,</span> <span class="nf">objectid</span><span class="p">(</span><span class="nv">ObjectId</span><span class="p">),</span> <span class="nf">parent</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="nv">ParentObjectId</span><span class="p">))),</span>
</span></span><span class="line"><span class="cl">    <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="nv">ParentObjectId</span><span class="p">),</span> <span class="nv">Roles</span><span class="p">,</span> <span class="nv">User</span><span class="p">).</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><ol start="2">
<li>Variant 2:</li>
</ol>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="nv">ObjectId</span><span class="p">),</span> <span class="nv">Roles</span><span class="p">,</span> <span class="nv">User</span><span class="p">)</span> <span class="p">:-</span>
</span></span><span class="line"><span class="cl">    <span class="nf">optional_object_permissions</span><span class="p">(</span><span class="nv">ObjectId</span><span class="p">,</span> <span class="nv">Roles</span><span class="p">,</span> <span class="nv">Permissions</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nf">in_list</span><span class="p">(</span><span class="nv">User</span><span class="p">,</span> <span class="nv">Permissions</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"><span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="nv">ObjectId</span><span class="p">),</span> <span class="nv">Roles</span><span class="p">,</span> <span class="nv">User</span><span class="p">)</span> <span class="p">:-</span>
</span></span><span class="line"><span class="cl">    <span class="nf">directory</span><span class="p">(</span><span class="k">_</span><span class="p">,</span> <span class="nf">objectid</span><span class="p">(</span><span class="nv">ObjectId</span><span class="p">),</span> <span class="nf">parent</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="nv">ParentObjectId</span><span class="p">))),</span>
</span></span><span class="line"><span class="cl">    <span class="nf">optional_object_permissions</span><span class="p">(</span><span class="nv">ObjectId</span><span class="p">,</span> <span class="nv">Roles</span><span class="p">,</span> <span class="nv">Permissions</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="s">\+</span> <span class="nf">in_list</span><span class="p">(</span><span class="nv">User</span><span class="p">,</span> <span class="nv">Permissions</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="nv">ParentObjectId</span><span class="p">),</span> <span class="nv">Roles</span><span class="p">,</span> <span class="nv">User</span><span class="p">).</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Variant 2 is more explicit. However, Variant 2 is also very inefficient:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="s">false</span><span class="p">.</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Variant 1 is a much more efficient:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Call</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;851a7566-b83d-4993-bd04-9b8244091d45&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;b94c1f40-818b-47be-882b-ce1a8fbee254&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">T</span> <span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="nv">Fail</span><span class="s">:</span> <span class="nf">inherits</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;7f916bd9-f324-40f2-97d3-95e7cc7d722e&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="s">jake</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="s">false</span><span class="p">.</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>While I wasn&rsquo;t able to understand why, I will come back to this problem in the future. This is a good opportunity to learn how to debug Prolog programs.</p>
<h2 id="querying-file-permissions-directly"><a href="#querying-file-permissions-directly" class="anchor-link">§</a>querying file permissions directly</h2>
<p>In the previous step, we had no ability to query for file permissions directly. Instead of a file ID, we had to use the ID of its parent directory. Let&rsquo;s define an API to query for file permissions directly. There are two cases to consider:</p>
<ul>
<li>Permissions can be attached directly to a file. This is the case for Jake who can view <em>a-file.pdf</em> and nothing else.</li>
<li>If there are no permissions attached directly to a file, resort to the parent traversal technique.</li>
</ul>
<p>Here&rsquo;s the code:</p>
<script type="application/javascript" src="https://gist.github.com/radekg/192ed65e53299bce74f59cfdbabf94ac.js?file=05-api.pl"></script>

<p>There&rsquo;s a lot of duplication here. This API could be generalized, but for now, it will be sufficient. There are three different APIs depending on the access level we intend to query for.</p>
<p>Let&rsquo;s look at one of them:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="c1">% Viewer query API:</span>
</span></span><span class="line"><span class="cl"><span class="nf">is_doc_viewer</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="nv">X</span><span class="p">),</span> <span class="nv">User</span><span class="p">)</span> <span class="p">:-</span>
</span></span><span class="line"><span class="cl">    <span class="nf">object_permissions</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="p">[</span><span class="s">viewers</span><span class="p">,</span> <span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="nv">Permitted</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nf">in_list</span><span class="p">(</span><span class="nv">User</span><span class="p">,</span> <span class="nv">Permitted</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"><span class="nf">is_doc_viewer</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="nv">X</span><span class="p">),</span> <span class="nv">User</span><span class="p">)</span> <span class="p">:-</span>
</span></span><span class="line"><span class="cl">    <span class="nf">document</span><span class="p">(</span><span class="k">_</span><span class="p">,</span> <span class="nf">objectid</span><span class="p">(</span><span class="nv">X</span><span class="p">),</span> <span class="nf">parent</span><span class="p">(</span><span class="nv">ParentId</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">    <span class="nf">inherits</span><span class="p">(</span><span class="nv">ParentId</span><span class="p">,</span> <span class="p">[</span><span class="s">viewers</span><span class="p">,</span> <span class="s">editors</span><span class="p">,</span> <span class="s">owners</span><span class="p">],</span> <span class="nv">User</span><span class="p">).</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Remembering that the predicate order is important, querying for a document ID will first check if there are permissions defined for the file object ID. This can be considered an <em>O(1)</em> operation, pretty cheap in terms of computing so safe to start with. If permissions have been found, we check if the user has been found in the complete list for that object.</p>
<p>Otherwise, we revert to the inheritance check. The fallback happens in case of:</p>
<ul>
<li>There are no permissions attached directly to the file object.</li>
<li>Permissions were found but used hasn&rsquo;t been granted the requested role directly on the file object.</li>
</ul>
<p>I like this example because it shows how efficient Prolog code can be. It translates to some thing like:</p>
<pre tabindex="0"><code>function run_inheritance_check(objectid, roles, user)
  parentid = get_document(objectid)
  return inherits(parentid, roles, user)
end function

if exist, permitted = object_permissions(objectid, roles); exist
  if in_list(user, permitted)
    return true
  // else
  return run_inheritance_check(objectid, roles, user)
else
  return run_inheritance_check(objectid, roles, user)
end if
</code></pre><p><strong>Note:</strong> It reminds me very much of Erlang. The first version of Erlang was implemented in Prolog and the influence is clearly visible to this day.</p>
<p>Let&rsquo;s load this up in <em>swipl</em>.</p>
<p>First, download the API program from GitHub:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">cd</span> /tmp/zanzibar
</span></span><span class="line"><span class="cl">wget -O 05-api.pl <span class="s2">&#34;</span><span class="si">${</span><span class="nv">base_url</span><span class="si">}</span><span class="s2">/05-api.pl&#34;</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>If your previous <em>swipl</em> session is still running, simply load the API program:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="s">?-</span> <span class="p">[</span><span class="s2">&#34;05-api.pl&#34;</span><span class="p">].</span>
</span></span><span class="line"><span class="cl"><span class="s">true</span><span class="p">.</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Let&rsquo;s talk about Jake.</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="c1">% Can Jake view the file a-file.pdf (object ID bee100a0-30b1-4184-94aa-3d408b75e938)?</span>
</span></span><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">is_doc_viewer</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;bee100a0-30b1-4184-94aa-3d408b75e938&#39;</span><span class="p">),</span> <span class="s">jake</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"><span class="s">true</span> <span class="p">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">% Can Jake view the sibling another.pdf (object ID ecf47371-fd08-44f1-9c06-7c970d948ae8)?</span>
</span></span><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">is_doc_viewer</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;ecf47371-fd08-44f1-9c06-7c970d948ae8&#39;</span><span class="p">),</span> <span class="s">jake</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"><span class="s">false</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">% Is Jake an editor of the file he can see?</span>
</span></span><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">is_doc_editor</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;bee100a0-30b1-4184-94aa-3d408b75e938&#39;</span><span class="p">),</span> <span class="s">jake</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"><span class="s">false</span><span class="p">.</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>What about Alan?</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="c1">% Can Alan see files in the pdfs directory?</span>
</span></span><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">is_doc_viewer</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;ecf47371-fd08-44f1-9c06-7c970d948ae8&#39;</span><span class="p">),</span> <span class="s">alan</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"><span class="s">true</span> <span class="p">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">is_doc_viewer</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;bee100a0-30b1-4184-94aa-3d408b75e938&#39;</span><span class="p">),</span> <span class="s">alan</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"><span class="s">true</span> <span class="p">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">% But he should not be allowed to edit:</span>
</span></span><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">is_doc_editor</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;bee100a0-30b1-4184-94aa-3d408b75e938&#39;</span><span class="p">),</span> <span class="s">alan</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"><span class="s">false</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">% Alan doesn&#39;t own anything, certainly.</span>
</span></span><span class="line"><span class="cl"><span class="s">?-</span> <span class="nf">is_doc_owner</span><span class="p">(</span><span class="nf">objectid</span><span class="p">(</span><span class="s">&#39;bee100a0-30b1-4184-94aa-3d408b75e938&#39;</span><span class="p">),</span> <span class="s">alan</span><span class="p">).</span>
</span></span><span class="line"><span class="cl"><span class="s">false</span><span class="p">.</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Actually, that&rsquo;s not true. Alan owns an old Volvo. But he doesn&rsquo;t own any files so everything works as expected.</p>
<h2 id="summary"><a href="#summary" class="anchor-link">§</a>summary</h2>
<p>This program is 52 lines of code, half of it is a clumsy, non-general API. The other half contains:</p>
<ul>
<li>Almost general solver for any inheritance problem where an object has exactly one parent. Almost, because <code>inherits/3</code> directly references <code>directory(X, Y, Z).</code> facts.
<ul>
<li>To generalize this solver for other fact types, one has to either:
<ul>
<li>find a way to provide the type of a fact to query for,</li>
<li>or create a general fact container.</li>
<li>The second approach would probably be easier to implement.</li>
<li>Frankly, the reason why I&rsquo;m calling the fact a <code>directory</code> and a <code>document</code> is illustrative only.</li>
</ul>
</li>
</ul>
</li>
<li>A general solver for any number of roles.
<ul>
<li>Roles in permissions are represented as a list of <code>[role₁, [identity₁, ...], ... roleₙ, [identityₙ, ...]]</code>.</li>
<li>There can be any number of roles in that list.</li>
<li>The API is where the knowledge of exact roles is required.</li>
</ul>
</li>
<li>The API could be generalized.</li>
</ul>
<h2 id="thoughts-on-prolog"><a href="#thoughts-on-prolog" class="anchor-link">§</a>thoughts on Prolog</h2>
<p>This section is strongly inspired by the <a href="https://en.wikipedia.org/wiki/Prolog" target="_blank" rel="noopener">Prolog Wikipedia page</a><sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">[3]</a></sup>.</p>
<p>Prolog, short for <em>PROgramming in LOGic</em>, is nothing like your regular programming language. It focuses on declarative style logic programming. Programs are expressed as relations represented by facts and rules. The computation is executed by running queries over these relations. The program applies predefined logic and evaluates to <em>true/false</em> (or <em>yes/no</em>, tomato, tomato).</p>
<p>That, however, doesn&rsquo;t mean that Prolog cannot be applied to interesting problems. In fact, Prolog is widely used in artificial intelligence, theorem proving, expert systems, or—its original intended application—natural language processing.</p>
<p>Prolog&rsquo;s heritage includes the research on theorem provers and other automated deduction systems developed in the 1960s and 1970s. The <em>first</em> Prolog was developed and implemented in Marseille, France, in 1972 by <em>Alain Colmerauer</em> and <em>Philippe Roussel</em>. Their work was based on <em>Robert Kowalski&rsquo;s</em> procedural implementation of Horn clauses at the University of Edinburgh. The first implementation of Prolog was called <em>Marseille Prolog</em>, the interpreter was implemented in Fortran by <em>Gerard Battani</em> and <em>Henri Meloni</em>. <em>David H. D. Warren</em> took this original interpreter to the University of Edinburgh where he developed an alternative front-end. <em>Edinburgh Prolog</em> syntax was born. This syntax is used by most of the modern Prolog implementations.</p>
<p>The language does not have conditional statements, there are no loops, and there&rsquo;s no state mutation. Prolog provides logical variables, integers, floats, atoms, and compound terms. Working with lists is not uncommon. Individual implementations may provide additional types. For example, SWI-Prolog provides strings, the empty list <em>Nil</em> (<code>[]</code>), list cons-cell (<code>[|]</code>), and dictionaries.</p>
<p>The original pure Prolog was restricted to the use of a resolution theorem prover with Horn clauses:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-prolog" data-lang="prolog"><span class="line"><span class="cl"><span class="nv">H</span> <span class="p">:-</span> <span class="nv">B</span><span class="s">₁</span><span class="p">,</span> <span class="p">...,</span> <span class="nv">B</span><span class="s">ₙ.</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Which means:</p>
<blockquote>
<p>To solve H, solve B₁ and &hellip; Bₙ.</p>
</blockquote>
<p>Later, Prolog has been extended to include negation as failure. Conditions in a form <em>not(Bₜ)</em> are shown by trying and failing to solve corresponding positive conditions <em>Bₜ</em>.</p>
<p>At least a couple of dozens free and commercial implementations of Prolog exist. <a href="https://en.wikipedia.org/wiki/Comparison_of_Prolog_implementations" target="_blank" rel="noopener">This Wikipedia page gives a brief summary</a><sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">[4]</a></sup>. But even that isn&rsquo;t complete. There exist Prolog implementations for almost every major programming language. For example:</p>
<ul>
<li><a href="https://github.com/ichiban/prolog" target="_blank" rel="noopener">ichiban/prolog</a><sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">[5]</a></sup> for Go.</li>
<li><a href="https://github.com/mthom/scryer-prolog" target="_blank" rel="noopener">mthom/scryer-prolog</a><sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">[6]</a></sup> for Rust.</li>
</ul>
<p>These implementations enable scripting capabilities in otherwise compiled, statically typed languages.</p>
<p>I am very impressed with Prolog, but also kind of disappointed with myself that I haven&rsquo;t learned it earlier. By the way, a month from now, Prolog will be 50 years old. That’s 10 years older than me.</p>
<p>Better late than never.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="/posts/2022-05-07-zanzibar-style-acls-with-opa-rego/">Zanzibar-style ACLs with OPA Rego</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" class="icon footnote-icon"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg></a>&#160;<a href="#fnref1:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p><a href="https://www.javatpoint.com/unification-in-prolog" target="_blank" rel="noopener">Unification in Prolog</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" class="icon footnote-icon"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg></a></p>
</li>
<li id="fn:3">
<p><a href="https://en.wikipedia.org/wiki/Prolog" target="_blank" rel="noopener">Prolog Wikipedia page</a>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" class="icon footnote-icon"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg></a></p>
</li>
<li id="fn:4">
<p><a href="https://en.wikipedia.org/wiki/Comparison_of_Prolog_implementations" target="_blank" rel="noopener">Comparison of Prolog implementations</a>&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" class="icon footnote-icon"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg></a></p>
</li>
<li id="fn:5">
<p><a href="https://github.com/ichiban/prolog" target="_blank" rel="noopener">ichiban/prolog</a>&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" class="icon footnote-icon"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg></a></p>
</li>
<li id="fn:6">
<p><a href="https://github.com/mthom/scryer-prolog" target="_blank" rel="noopener">mthom/scryer-prolog</a>&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" class="icon footnote-icon"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg></a></p>
</li>
</ol>
</div>

            </div>

            
    
    
        <ul class="post-copyright">
            <li class="copyright-item author"><span class="copyright-item-text">Author</span>: <a href="https://io-oi.me/" class="p-author h-card" target="_blank" rel="noopener">radek gruchalski</a></li>
            
                
                
                
                
                <li class="copyright-item link"><span class="copyright-item-text">Link</span>: <a href="/posts/2022-09-03-zanzibar-style-acls-with-prolog/" target="_blank" rel="noopener">https://gruchalski.com/posts/2022-09-03-zanzibar-style-acls-with-prolog/</a></li>
            
            <li class="copyright-item license"><span class="copyright-item-text">License</span>: <a href="https://en.wikipedia.org/wiki/Canonical_link_element" target="_blank" rel="noopener">reposting requires attribution, <strong>use canonical links</strong> »</a></li>
            
        </ul>
    



        </article>

        

        


        


        <div class="post-share">

        

        <div class="share-items">

            
                <div class="share-item twitter">
                    
                    <a href="https://twitter.com/share?url=https://gruchalski.com/posts/2022-09-03-zanzibar-style-acls-with-prolog/&amp;text=Zanzibar-style%20ACLs%20with%20Prolog&amp;hashtags=prolog,datalog,zanzibar,opa,&amp;via=%25!s%28%3cnil%3e%29" title="Share on Twitter" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon twitter-icon"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a>
                </div>
            

            

            
                <div class="share-item linkedin">
                    
                    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://gruchalski.com/posts/2022-09-03-zanzibar-style-acls-with-prolog/&amp;title=Zanzibar-style%20ACLs%20with%20Prolog&amp;summary=Back%20in%20May,%20I%20looked%20at%20an%20implementation%20of%20Zanzibar-style%20ACLs%20in%20Open%20Policy%20Agent%20Rego1.%0aI%e2%80%99m%20revisiting%20that%20problem%20while%20learning%20Prolog,%20another%20language%20from%20my%20never-ending%20to-learn%20list.%20There%20are%20some%20similarities%20to%20the%20previous%20article,%20but%20I%e2%80%99m%20taking%20the%20problem%20further:%20I%e2%80%99m%20adding%20permissions%20inheritance%20from%20anywhere%20within%20the%20filesystem%20tree.&amp;source=gruchalski.com" title="Share on LinkedIn" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon linkedin-icon"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg></a>
                </div>
            

            

            

            

            

            

            
                <div class="share-item qrcode">
                    <div class="qrcode-container" title="Share via QR Code"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon qrcode-icon"><path d="M0 224h192V32H0v192zM64 96h64v64H64V96zm192-64v192h192V32H256zm128 128h-64V96h64v64zM0 480h192V288H0v192zm64-128h64v64H64v-64zm352-64h32v128h-96v-32h-32v96h-64V288h96v32h64v-32zm0 160h32v32h-32v-32zm-64 0h32v32h-32v-32z"/></svg><div id="qrcode-img"></div>
                    </div>
                    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>

<script>
    var typeNumber = 0;
    var errorCorrectionLevel = 'L';
    var qr = qrcode(typeNumber, errorCorrectionLevel);
    qr.addData('https:\/\/gruchalski.com\/posts\/2022-09-03-zanzibar-style-acls-with-prolog\/');
    qr.make();
    document.getElementById('qrcode-img').innerHTML = qr.createImgTag();
</script>

                </div>
            

        </div>

    </div>




        
    
    
        <div class="related-posts">
            <h2 class="related-title">See Also:<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon related-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92h-92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"/></svg></h2>
            <ul class="related-list">
                
                    <li class="related-item">
                        <a href="/posts/2022-09-10-zanzibar-with-prolog-week-2/" class="related-link">Zanzibar with Prolog, week 2</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/2022-10-22-zanzibar-with-prolog-summary/" class="related-link">Zanzibar with Prolog - summary</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/2022-05-07-zanzibar-style-acls-with-opa-rego/" class="related-link">Zanzibar-style ACLs with OPA Rego</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/2022-04-27-opa-logical-or-conditions/" class="related-link">OPA: logical or conditions</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/2021-05-17-keto-rbac-listing-roles-of-a-user/" class="related-link">Keto RBAC - listing roles of a user</a>
                    </li>
                
            </ul>
        </div>
    



        
    
        <div class="post-tags">
            
                
                
                
                
                    
                    <a href="/tags/prolog/" rel="tag" class="post-tags-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>prolog</a>
                
            
                
                
                
                
                    
                    <a href="/tags/datalog/" rel="tag" class="post-tags-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>datalog</a>
                
            
                
                
                
                
                    
                    <a href="/tags/zanzibar/" rel="tag" class="post-tags-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>zanzibar</a>
                
            
                
                
                
                
                    
                    <a href="/tags/opa/" rel="tag" class="post-tags-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>opa</a>
                
            
        </div>
    



        


        


        
    
        
        
    
    
    
    
        <ul class="post-nav">
            
                <li class="post-nav-prev">
                    <a href="/posts/2022-09-10-zanzibar-with-prolog-week-2/" rel="prev">&lt; Zanzibar with Prolog, week 2</a>
                </li>
            
            
                <li class="post-nav-next">
                    <a href="/posts/2022-08-28-i-enjoyed-modern-fortran/" rel="next">I enjoyed modern Fortran &gt;</a>
                </li>
            
        </ul>
    



        


    </div>
</main>


            
    <div id="back-to-top" class="back-to-top">
        <a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a>
    </div>


            
    <footer id="footer" class="footer">
        <div class="footer-inner">
            <div class="site-info">©&nbsp;2015–2023&nbsp;<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon footer-icon"><path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"/></svg>&nbsp;radek gruchalski</div><div class="powered-by">Powered by <a href="https://github.com/gohugoio/hugo" target="_blank" rel="noopener">Hugo</a> | Theme is <a href="https://github.com/reuixiy/hugo-theme-meme" target="_blank" rel="noopener">MemE</a></div><div class="site-copyright"><a href="https://en.wikipedia.org/wiki/Canonical_link_element" target="_blank" rel="noopener">reposting requires attribution, <strong>use canonical links</strong> »</a></div>

            
    
        <ul class="socials"><li class="socials-item">
                    <a href="/rss.xml" target="_blank" rel="external noopener" title="RSS"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon social-icon"><path d="M19.199 24C19.199 13.467 10.533 4.8 0 4.8V0c13.165 0 24 10.835 24 24h-4.801zM3.291 17.415c1.814 0 3.293 1.479 3.293 3.295 0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526 0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727 0 15.909 7.184 15.909 15.91z"/></svg></a>
                </li><li class="socials-item">
                    <a href="mailto:radek@gruchalski.com" target="_blank" rel="external noopener" title="Email"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon social-icon"><path d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"/></svg></a>
                </li><li class="socials-item">
                    <a href="https://github.com/radekg" target="_blank" rel="external noopener" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon social-icon"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
                </li><li class="socials-item">
                    <a href="https://linkedin.com/in/radgruchalski" target="_blank" rel="external noopener" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon social-icon"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg></a>
                </li></ul>
    



            
        </div>
    </footer>


        </div>
        

        








    <script src="https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js"></script>

<script>
    mediumZoom(document.querySelectorAll('div.post-body img'), {
        background: 'hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)'
    })
</script>




    <script src="https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js" type="module" defer></script>







    </body>
</html>
