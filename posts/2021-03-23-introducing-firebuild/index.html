<!DOCTYPE html>
<html lang="en">
    <head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
    <meta charset="UTF-8" />

    <meta name="generator" content="Hugo 0.80.0" /><meta name="theme-color" content="#fff" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <meta name="format-detection" content="telephone=no, date=no, address=no, email=no" />
    
    <meta http-equiv="Cache-Control" content="no-transform" />
    
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>Introducing firebuild | gruchalski.com</title>

    <link rel="stylesheet" href="/css/meme.min.c52d01779616c51cf9e5645a858d46e5aeb85f3cf186b96d11f0e45b87171345.css"/>

    
    
        <script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js" defer></script><script src="/js/meme.min.fc0f513738a24e23b949d4dc49d33bb07a2bcd2edcc9601d8ceae1a2d27cdb5f.js"></script>

    

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM&#43;Plex&#43;Serif:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;family=Amaranth&amp;display=swap" media="print" onload="this.media='all'" />
        <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM&#43;Plex&#43;Serif:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;family=Amaranth&amp;display=swap" /></noscript>

    <meta name="author" content="Radek Gruchalski" /><meta name="description" content="Manage firecracker root file systems and VMMs" />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#2a6df4" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="gruchalski.com" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="gruchalski.com" />
    <meta name="msapplication-starturl" content="../../" />
    <meta name="msapplication-TileColor" content="#fff" />
    <meta name="msapplication-TileImage" content="../../icons/mstile-150x150.png" />
    <link rel="manifest" href="/manifest.json" />

    
    

    
    
        
        <link rel="canonical" href="https://radek-gruchalski.medium.com/introducing-firebuild-342becccc43b" />
    

    

<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "datePublished": "2021-03-23T00:00:00+00:00",
        "dateModified": "2021-04-29T19:10:25+02:00",
        "url": "https://gruchalski.com/posts/2021-03-23-introducing-firebuild/",
        "headline": "Introducing firebuild",
        "description": "Manage firecracker root file systems and VMMs",
        "inLanguage" : "en",
        "articleSection": "posts",
        "wordCount":  2370 ,
        "image": "https://gruchalski.com/icons/apple-touch-icon.png",
        "author": {
            "@type": "Person",
            "email": "radek@gruchalski.com",
            "image": "https://gruchalski.com/icons/apple-touch-icon.png",
            "url": "https://io-oi.me/",
            "name": "radek gruchalski"
        },
        "license": "[reposting requires attribution, **use canonical links** »](https://en.wikipedia.org/wiki/Canonical_link_element)",
        "publisher": {
            "@type": "Organization",
            "name": "gruchalski.com",
            "logo": {
                "@type": "ImageObject",
                "url": "https://gruchalski.com/icons/apple-touch-icon.png"
            },
            "url": "https://gruchalski.com/"
        },
        "mainEntityOfPage": {
            "@type": "WebSite",
            "@id": "https://gruchalski.com/"
        }
    }
</script>

    

<meta name="twitter:card" content="summary" />


    



<meta property="og:title" content="Introducing firebuild" />
<meta property="og:description" content="Manage firecracker root file systems and VMMs" />
<meta property="og:url" content="https://gruchalski.com/posts/2021-03-23-introducing-firebuild/" />
<meta property="og:site_name" content="gruchalski.com" />
<meta property="og:locale" content="en" /><meta property="og:image" content="/assets/posts/2021-03-23/header.png" />
<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2021-03-23T00:00:00&#43;00:00" />
    <meta property="article:modified_time" content="2021-04-29T19:10:25&#43;02:00" />
    
    <meta property="article:section" content="posts" />


        <link rel="preconnect" href="https://www.google-analytics.com" crossorigin />

        




    
    <script>
        var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
        var doNotTrack = (dnt == "1" || dnt == "yes");
        if (!doNotTrack) {
            window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
            if (window.sessionStorage) {
                var GA_SESSION_STORAGE_KEY = 'ga:clientId';
                ga('create', 'UA-39073034-1', {
                'storage': 'none',
                'clientId': sessionStorage.getItem(GA_SESSION_STORAGE_KEY)
               });
               ga(function(tracker) {
                sessionStorage.setItem(GA_SESSION_STORAGE_KEY, tracker.get('clientId'));
               });
           }
            ga('set', 'anonymizeIp', true);
            ga('send', 'pageview');
        }
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    


    
    

    
</head>

    <body>
        <div class="container">
            
    <header class="header">
        
            <div class="header-wrapper">
                <div class="header-inner single">
                    
    <div class="site-brand">
        
            <a href="/" class="brand">gruchalski.com</a>
        
    </div>

                    <nav class="nav">
    <ul class="menu" id="menu">
        
            
        
        
        
        
            
                <li class="menu-item"><a href="/posts/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon archive"><path d="M32 448c0 17.7 14.3 32 32 32h384c17.7 0 32-14.3 32-32V160H32v288zm160-212c0-6.6 5.4-12 12-12h104c6.6 0 12 5.4 12 12v8c0 6.6-5.4 12-12 12H204c-6.6 0-12-5.4-12-12v-8zM480 32H32C14.3 32 0 46.3 0 64v48c0 8.8 7.2 16 16 16h480c8.8 0 16-7.2 16-16V64c0-17.7-14.3-32-32-32z"/></svg><span class="menu-item-name">posts</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/tags/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="icon tags"><path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"/></svg><span class="menu-item-name">tags</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/about/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="icon user-circle"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"/></svg><span class="menu-item-name">about</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/privacy/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512" class="icon info"><path d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"/></svg><span class="menu-item-name">privacy</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href=""></a>
                </li>
            
        
            
                
            
        
    </ul>
</nav>

                    
                </div>
            </div>
            
    <input type="checkbox" id="nav-toggle" aria-hidden="true" />
    <label for="nav-toggle" class="nav-toggle"></label>
    <label for="nav-toggle" class="nav-curtain"></label>


        
    </header>




            
            
    <main class="main single" id="main">
    <div class="main-inner">

        

        <article class="content post h-entry" data-align="default" data-type="posts" data-toc-num="true">

            <h1 class="post-title p-name">Introducing firebuild</h1>

            

            
                <div class="post-description p-summary">Manage firecracker root file systems and VMMs</div>
                
            

            
                

<div class="post-meta">
    
        
        <time datetime="2021-03-23T00:00:00&#43;00:00" class="post-meta-item published dt-published"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"/></svg>&nbsp;March 23, 2021</time>
    
    
    
    
        
        
        
            
        
    
    
        
        <span class="post-meta-item wordcount"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;2370</span>
    
    
        
        <span class="post-meta-item reading-time"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;12&nbsp;mins</span>
    
    
    
</div>

            

            
                <img src="/assets/posts/2021-03-23/header.png" alt="thumbnail" class="p-article__thumbnail">
            

            <div class="post-body e-content">
              <h2 id="what-is-firecracker"><a href="#what-is-firecracker" class="anchor-link">§</a>what is Firecracker</h2>
<p>Firecracker is a virtualization technology for creating and managing secure, multi-tenant services suited for container-like and serverless scenarios. Firecracker workloads run in virtual machines, not containers. Unlike containers, they benefit from extra isolation properties provided by the hardware virtualization. Similar to containers, Firecracker VMs—microVMs—are lightweight and fast to boot. Like containers, they can be treated like cattle. They combine the flexibility of containers and security of virtual machines. These little things can be started in as little as 125 milliseconds and a single host can manage thousands of them! Firecracker was developed at Amazon Web Services primarily for Lambda and Fargate offerings.</p>
<p>Firecracker uses Kernel Virtual Machine (KVM) to create and run microVMs. A minimalist design is achieved by removing unnecessary devices and guest-facing functionality. This reduces the memory footprint and attack surface of each individual VM leading to better utilization and increased security. At minimum, a microVM requires a Linux kernel image and a root file system. Networking can be provided by setting up interfaces manually or with container network interface (CNI).</p>
<p>Firecracker is a couple of years old. Pretty young in the technology world but there are already interesting integrations out there. Kata Containers and WeaveWorks Ignite are the major ones.</p>
<h2 id="firebuild"><a href="#firebuild" class="anchor-link">§</a>firebuild</h2>
<p>There is only so much one can learn by looking at existing tools. The best way is to take something and build another useful thing on top of it. Only this way one can hit roadblocks cleared by others. Only this way one can investigate alternative avenues, possibly not considered before. That is why a few weeks ago I have started working on <code>firebuild</code>. <a href="https://github.com/combust-labs/firebuild" target="_blank" rel="noopener">The source code is on GitHub</a><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">[1]</a></sup>.</p>
<p>With <code>firebuild</code> it is possible to:</p>
<ul>
<li>build root file systems directly from Dockerfiles</li>
<li>tag and version root file systems</li>
<li>run and manage microVMs on a single host</li>
<li>define run profiles</li>
</ul>
<p>The concept of <code>firebuild</code> is to leverage as much of the existing Docker world as possible. There are thousands of Docker images out there. Docker images are awesome because they encapsulate the software we want to run in our workloads, they also encapsulate dependencies. Dockerfiles are what Docker images are built from. Dockeriles are the blueprints of the modern infrastructure. There are thousands of them for almost anything one can imagine and new ones are very easy to write.</p>
<h2 id="an-image-is-worth-more-than-a-thousand-words"><a href="#an-image-is-worth-more-than-a-thousand-words" class="anchor-link">§</a>an image is worth more than a thousand words</h2>
<p>Ah, but the idea is pretty difficult to visualize with a single image. So, instead, let me walk you though this example of running HashiCorp Consul 1.9.4 on Firecracker. I promise, any questions are answered further.</p>
<p>Before going all in, <a href="https://gruchalski.com/posts/2021-03-22-firebuild-prerequisites/" target="_blank" rel="noopener">some prerequisites</a><sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">[2]</a></sup>.</p>
<h3 id="create-a-firebuild-profile"><a href="#create-a-firebuild-profile" class="anchor-link">§</a>create a firebuild profile</h3>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">sudo <span class="nv">$GOPATH</span>/bin/firebuild profile-create <span class="se">\
</span><span class="se"></span>	--profile<span class="o">=</span>standard <span class="se">\
</span><span class="se"></span>	--binary-firecracker<span class="o">=</span><span class="k">$(</span>readlink /usr/bin/firecracker<span class="k">)</span> <span class="se">\
</span><span class="se"></span>	--binary-jailer<span class="o">=</span><span class="k">$(</span>readlink /usr/bin/jailer<span class="k">)</span> <span class="se">\
</span><span class="se"></span>	--chroot-base<span class="o">=</span>/fc/jail <span class="se">\
</span><span class="se"></span>	--run-cache<span class="o">=</span>/fc/cache <span class="se">\
</span><span class="se"></span>	--storage-provider<span class="o">=</span>directory <span class="se">\
</span><span class="se"></span>	--storage-provider-property-string<span class="o">=</span><span class="s2">&#34;rootfs-storage-root=/fc/rootfs&#34;</span> <span class="se">\
</span><span class="se"></span>	--storage-provider-property-string<span class="o">=</span><span class="s2">&#34;kernel-storage-root=/fc/vmlinux&#34;</span>
</code></pre></td></tr></table></div>
</div>
</div><h3 id="create-a-base-operating-system-root-file-system-baseos"><a href="#create-a-base-operating-system-root-file-system-baseos" class="anchor-link">§</a>create a base operating system root file system (baseos)</h3>
<p><code>firebuild</code> uses the Docker metaphor. An image of an application is built <code>FROM</code> a base. An application image can be built <code>FROM alpine:3.13</code>, for example. Or <code>FROM debian:buster-slim</code>, or <code>FROM registry.access.redhat.com/ubi8/ubi-minimal:8.3</code> and dozens others.</p>
<p>In order to fulfill those semantics, a base operating system image must be built before the application root file system can be created.</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">sudo <span class="nv">$GOPATH</span>/bin/firebuild baseos <span class="se">\
</span><span class="se"></span>    --profile<span class="o">=</span>standard <span class="se">\
</span><span class="se"></span>    --dockerfile <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/baseos/_/alpine/3.12/Dockerfile
</code></pre></td></tr></table></div>
</div>
</div><h3 id="create-a-root-file-system-of-the-application-rootfs"><a href="#create-a-root-file-system-of-the-application-rootfs" class="anchor-link">§</a>create a root file system of the application (rootfs)</h3>
<p>To run an instance of HashiCorp Consul, <code>firebuild</code> requires the Consul application root file system. To build one:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">sudo <span class="nv">$GOPATH</span>/bin/firebuild rootfs <span class="se">\
</span><span class="se"></span>    --profile<span class="o">=</span>standard <span class="se">\
</span><span class="se"></span>    --dockerfile<span class="o">=</span>git+https://github.com/hashicorp/docker-consul.git:/0.X/Dockerfile <span class="se">\
</span><span class="se"></span>    --cni-network-name<span class="o">=</span>machine-builds <span class="se">\
</span><span class="se"></span>    --ssh-user<span class="o">=</span>alpine <span class="se">\
</span><span class="se"></span>    --vmlinux-id<span class="o">=</span>vmlinux-v5.8 <span class="se">\
</span><span class="se"></span>    --tag<span class="o">=</span>combust-labs/consul:1.9.4
</code></pre></td></tr></table></div>
</div>
</div><h3 id="start-the-application"><a href="#start-the-application" class="anchor-link">§</a>start the application</h3>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">sudo <span class="nv">$GOPATH</span>/bin/firebuild run <span class="se">\
</span><span class="se"></span>    --profile<span class="o">=</span>standard <span class="se">\
</span><span class="se"></span>    --from<span class="o">=</span>combust-labs/consul:1.9.4 <span class="se">\
</span><span class="se"></span>    --cni-network-name<span class="o">=</span>machines <span class="se">\
</span><span class="se"></span>    --vmlinux-id<span class="o">=</span>vmlinux-v5.8
</code></pre></td></tr></table></div>
</div>
</div><h3 id="query-consul"><a href="#query-consul" class="anchor-link">§</a>query Consul</h3>
<p>First, find the VM ID:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">sudo <span class="nv">$GOPATH</span>/bin/firebuild ls <span class="se">\
</span><span class="se"></span>    --profile<span class="o">=</span>standard <span class="se">\
</span><span class="se"></span>    --log-as-json 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> jq <span class="s1">&#39;.id&#39;</span> -r
</code></pre></td></tr></table></div>
</div>
</div><p>In my case, the value is <code>wcabty1922gloailwrce</code>. I used it to get the IP address of the VM:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">$ sudo <span class="nv">$GOPATH</span>/bin/firebuild inspect <span class="se">\
</span><span class="se"></span>    --profile<span class="o">=</span>standard <span class="se">\
</span><span class="se"></span>    --vmm-id<span class="o">=</span>wcabty1922gloailwrce <span class="p">|</span> jq <span class="s1">&#39;.NetworkInterfaces[0].StaticConfiguration.IPConfiguration.IP&#39;</span> -r
</code></pre></td></tr></table></div>
</div>
</div><p>The command returned <code>192.168.127.89</code>. I could query Consul via REST API:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">curl http://192.168.127.89:8500/v1/status/leader
<span class="s2">&#34;127.0.0.1:8300&#34;</span>
</code></pre></td></tr></table></div>
</div>
</div><h2 id="what-the-heck-happened"><a href="#what-the-heck-happened" class="anchor-link">§</a>what the heck happened</h2>
<p>I have started by creating a <code>firebuild</code> profile. Technically <code>firebuild</code> does not require one. Common arguments may be provided on every execution. The profile exists for two reasons:</p>
<ul>
<li>it makes subsequent operations more concise by moving the tedious arguments away</li>
<li>provides extra isolation with different <code>chroots</code>, cache directories, and image / kernel catalogs</li>
</ul>
<p>The directories referenced in the profile must exist before a profile can be created.</p>
<p>In the next step, I have built a <em>base operating system root file system</em>. The <em>elephant in the room</em> question is:</p>
<blockquote>
<p>Why does this tool even require that step?</p>
</blockquote>
<p>Typical Linux in Docker has many parts removed. For example, there is no init system. Further, different base Docker images have often completely different sets of tools available. All that is for a good reason: Docker images supposed to be small, must start fast and limit the potential attack surface by removing what&rsquo;s unnecessary.</p>
<p><code>firebuild</code> <strong>builds Firecracker virtual machines</strong>. <strong>It does so from Dockerfile blueprints</strong>.</p>
<p>In order to provide a consistent experience, it requires a more or less functional multi-user Linux installation with components otherwise hidden in the Docker or OCI runtime. These base Linux installations are built from <code>firebuild</code> provided Dockerfiles, the <code>--dockerfile $(pwd)/baseos/_/alpine/3.12/Dockerfile</code> is a base Alpine 3.12. All the commands above were executed from <code>$GOPATH/src/github.com/combust-labs/firebuild</code> directory, hence the use of <code>$(pwd)</code> in the <code>baseos</code> build.</p>
<p><code>firebuild</code> uses Docker to build the base operating root file system by:</p>
<ul>
<li>building a Docker image from the provided Dockerfile</li>
<li>starting a container from newly built image</li>
<li>exporting the root file system of the container to the ext4 file on the host using Docker API <code>exec</code></li>
<li>removing the container and the image</li>
<li>persisting the built file in the storage provider and namespacing it, the example above results in the root file system stored in <code>/fc/rootfs/_/alpine/3.12/rootfs</code></li>
<li>persisting the build metadata next to the root file system file, above example gives <code>/fc/rootfs/_/alpine/3.12/metadata.json</code></li>
</ul>
<p>This custom <code>firebuild</code> provided Dockerfile is based on an upstream <code>alpine:3.12</code> from Docker Hub.</p>
<p><strong>The primary reason for following this path is</strong> to enable building Firecracker VMs from <strong>upstream Dockerfiles as often as possible</strong>. Other tools out there enable converting a Docker container into a <code>rootfs</code> file but to achieve that full VM experience, a Docker container has to be launched from a hand crafted Dockerfile or extra packages have to be installed on the running container before the export. Dockerfiles are fully auditable but these extra steps are not. The steps often differ between containers. It might be difficult to track how the <code>rootfs</code> was built, some benefits of using a blueprint could be lost.</p>
<p>The step 2 of the example builds Consul directly from the official HashiCorp Docker images GitHub repository. The application root file system was built using the <code>rootfs</code> command.</p>
<blockquote>
<p>Note: I refer to the application root file system as <code>rootfs</code>. Bit confusing at first because the result of the <code>baseos</code> command is technically also a <code>rootfs</code>. However, to mentally distinguish one from the other, I refer to to the base OS using the term <code>baseos</code> and an application is a <code>rootfs</code>. This may change in the future.</p>
</blockquote>
<p>The <code>rootfs</code> command does much more work than the <code>baseos</code> command.</p>
<p>It starts by fetching a Dockerfile from a source given via the <code>--dockerfile</code> argument. The source can be one of:</p>
<ul>
<li>a <code>git+http(s)://</code> style URL pointing at a git repository (does not have to be GitHub)</li>
<li>a <code>http://</code> of <code>https://</code> URL, be careful here: There Will Be Dragons (<a href="https://github.com/combust-labs/firebuild#caveats-when-building-from-the-url" target="_blank" rel="noopener">read more</a><sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">[3]</a></sup>)</li>
<li>a local file</li>
<li>an inline <code>Dockerfile</code></li>
<li>standard <code>ssh://</code>, <code>git://</code> and <code>git+ssh://</code> URL with a Dockerfile path appended via <code>:/path/to/Dockerfile</code></li>
</ul>
<p>The most convenient is the local file system build or a git repository. If a git repository is used, <code>firebuild</code> will clone a complete repository to a temporary directory and treat the build further as a local file system build. Once the sources are on disk, <code>firebuild</code> loads and parses the Dockerfile. <strong>This part is preliminary and will change in favor of unattended bootstrap without SSH requirement</strong>: Next, a build time VM is started, <code>firebuild</code> connects to it via SSH and runs all commands from the Dockerfile against that VM.</p>
<p>Resources referenced with <code>ADD</code> and <code>COPY</code> commands are treated likewise and supported. Remote resources are supported. <code>firebuild</code> does its best to properly reflect any <code>WORKDIR</code>, <code>USER</code> and <code>SHELL</code> conditions. It supports <code>--chown</code> flags for <code>ADD</code> and <code>COPY</code>.</p>
<p>What&rsquo;s more, <code>firebuild</code> supports multi-stage builds. <code>firebuild</code> will build any stages with <code>FROM ... as</code> as regular Docker images and extract resources from the stage to the main build when <code>COPY --from=</code> is found. For example, it&rsquo;s perfectly fine to build a Kafka Proxy root file system from:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">sudo <span class="nv">$GOPATH</span>/bin/firebuild rootfs <span class="se">\
</span><span class="se"></span>    --profile<span class="o">=</span>standard <span class="se">\
</span><span class="se"></span>    --dockerfile<span class="o">=</span>git+https://github.com/grepplabs/kafka-proxy.git:/Dockerfile#v0.2.8 <span class="se">\
</span><span class="se"></span>    --cni-network-name<span class="o">=</span>machine-builds <span class="se">\
</span><span class="se"></span>    --ssh-user<span class="o">=</span>alpine <span class="se">\
</span><span class="se"></span>    --vmlinux-id<span class="o">=</span>vmlinux-v5.8 <span class="se">\
</span><span class="se"></span>    --tag<span class="o">=</span>combust-labs/kafka-proxy:0.2.8
</code></pre></td></tr></table></div>
</div>
</div><p>The Dockerfile commands statements which are not supported: <code>ONBUILD</code>, <code>HEALTHCHECK</code> and <code>STOPSIGNAL</code> (although the last one will be supported at a later stage).</p>
<p>Once all of that is finished, the build VM will be stopped, cleaned up and the resulting root file system will be persisted in the storage provider. A metadata file is stored next to the root file system. Currently, only the directory based storage provider is available.</p>
<p>Finally, a resulting application is launched with the <code>run</code> command. The <code>run</code> command uses an unattended, cloud-init like mechanism. The metadata of the <code>baseos</code> and <code>rootfs</code> is combined. A guest facing version is put in MMDS (the Firecracker machine metadata service). MMDS provides a HTTP API available to both: the host and the guest. By default, if the guest was started with <code>--allow-mmds</code> flag, it can reach that API via <code>169.254.169.254</code> IP address. <code>firebuild</code> uses MMDS by default for all guests but this can be disabled. The guest facing metadata contains a bunch of information required to bootstrap the VM in a cloud-init style. These are fairly short so let&rsquo;s look at an example:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;latest&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;meta-data&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;Drives&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;1&#34;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;DriveID&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
          <span class="nt">&#34;IsReadOnly&#34;</span><span class="p">:</span> <span class="s2">&#34;false&#34;</span><span class="p">,</span>
          <span class="nt">&#34;IsRootDevice&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span>
          <span class="nt">&#34;Partuuid&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
          <span class="nt">&#34;PathOnHost&#34;</span><span class="p">:</span> <span class="s2">&#34;rootfs&#34;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nt">&#34;EntrypointJSON&#34;</span><span class="p">:</span> <span class="s2">&#34;{\&#34;Cmd\&#34;:[\&#34;agent\&#34;,\&#34;-dev\&#34;,\&#34;-client\&#34;,\&#34;0.0.0.0\&#34;],\&#34;EntryPoint\&#34;:[\&#34;docker-entrypoint.sh\&#34;],\&#34;Env\&#34;:{\&#34;HASHICORP_RELEASES\&#34;:\&#34;https://releases.hashicorp.com\&#34;},\&#34;Shell\&#34;:[\&#34;/bin/sh\&#34;,\&#34;-c\&#34;],\&#34;User\&#34;:\&#34;0:0\&#34;,\&#34;Workdir\&#34;:\&#34;/\&#34;}&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Env&#34;</span><span class="p">:</span> <span class="p">{},</span>
      <span class="nt">&#34;ImageTag&#34;</span><span class="p">:</span> <span class="s2">&#34;combust-labs/consul:1.9.4&#34;</span><span class="p">,</span>
      <span class="nt">&#34;LocalHostname&#34;</span><span class="p">:</span> <span class="s2">&#34;sharp-mirzakhani&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Machine&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;CPU&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
        <span class="nt">&#34;CPUTemplate&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;HTEnabled&#34;</span><span class="p">:</span> <span class="s2">&#34;false&#34;</span><span class="p">,</span>
        <span class="nt">&#34;KernelArgs&#34;</span><span class="p">:</span> <span class="s2">&#34;console=ttyS0 noapic reboot=k panic=1 pci=off nomodules rw&#34;</span><span class="p">,</span>
        <span class="nt">&#34;Mem&#34;</span><span class="p">:</span> <span class="s2">&#34;128&#34;</span><span class="p">,</span>
        <span class="nt">&#34;VMLinux&#34;</span><span class="p">:</span> <span class="s2">&#34;vmlinux-v5.8&#34;</span>
      <span class="p">},</span>
      <span class="nt">&#34;Network&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;CniNetworkName&#34;</span><span class="p">:</span> <span class="s2">&#34;machines&#34;</span><span class="p">,</span>
        <span class="nt">&#34;Interfaces&#34;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;b6:16:f2:3d:29:cf&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;Gateway&#34;</span><span class="p">:</span> <span class="s2">&#34;192.168.127.1&#34;</span><span class="p">,</span>
            <span class="nt">&#34;HostDeviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;tap0&#34;</span><span class="p">,</span>
            <span class="nt">&#34;IfName&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
            <span class="nt">&#34;IP&#34;</span><span class="p">:</span> <span class="s2">&#34;192.168.127.89&#34;</span><span class="p">,</span>
            <span class="nt">&#34;IPAddr&#34;</span><span class="p">:</span> <span class="s2">&#34;192.168.127.89/24&#34;</span><span class="p">,</span>
            <span class="nt">&#34;IPMask&#34;</span><span class="p">:</span> <span class="s2">&#34;ffffff00&#34;</span><span class="p">,</span>
            <span class="nt">&#34;IPNet&#34;</span><span class="p">:</span> <span class="s2">&#34;ip+net&#34;</span><span class="p">,</span>
            <span class="nt">&#34;NameServers&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nt">&#34;Users&#34;</span><span class="p">:</span> <span class="p">{},</span>
      <span class="nt">&#34;VMMID&#34;</span><span class="p">:</span> <span class="s2">&#34;wcabty1922gloailwrce&#34;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table></div>
</div>
</div><p>The metadata contains information about attached drives, network interfaces, simple machine data, entrypoint info and user&rsquo;s SSH keys, if <code>--identity-file</code> and <code>--ssh-user</code> arguments were provided. The component responsible for bootstrapping the VM from this data is called <code>vminit</code> and can be found <a href="https://github.com/combust-labs/firebuild-mmds" target="_blank" rel="noopener">in this GitHub repository</a><sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">[4]</a></sup>. The compiled binary is baked into the <code>baseos</code> (suboptimal but it&rsquo;s a first iteration) and invoked as a system service on VM start.</p>
<p>Currently, <code>vminit</code> does the following:</p>
<ul>
<li>update <code>/etc/hosts</code> file if the VM has a network interface and make sure the VM resolves itself via configured <code>hostname</code> on the interface IP address</li>
<li>update <code>/etc/hostname</code> to the configured <code>hostname</code></li>
<li>create an environment variables <code>/etc/profile.d/run-env.sh</code> file for any variables passed via <code>--env</code> and <code>--env-file</code> flags of the <code>run</code> command</li>
<li>when <code>users</code> contains a user entry with SSH keys, write those SSH keys to the respective <code>authorized_keys</code> file to enable SSH access; an example of a user entry:</li>
</ul>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="s2">&#34;Users&#34;</span><span class="err">:</span> <span class="p">{</span>
  <span class="nt">&#34;alpine&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;SSHKeys&#34;</span><span class="p">:</span> <span class="s2">&#34;ssh-rsa ... \nssh-rsa ...\n&#34;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table></div>
</div>
</div><ul>
<li>write the <code>/usr/bin/firebuild-entrypoint.sh</code> program responsible for invoking the <code>entrypoint</code> from MMDS data</li>
</ul>
<p>When the machine starts, <code>vminit</code> looks for the <code>/usr/bin/firebuild-entrypoint.sh</code> and if one is found, executes it. Fingers crossed, things went well and the application starts automatically.</p>
<p>That was a high level overview of the process.</p>
<h2 id="other-useful-vm-related-commands"><a href="#other-useful-vm-related-commands" class="anchor-link">§</a>other useful VM related commands</h2>
<p>List running VMs:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">sudo firebuild ls --profile<span class="o">=</span>standard
</code></pre></td></tr></table></div>
</div>
</div><p>Inspect the metadata of a running VM:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">sudo firebuild inspect --profile<span class="o">=</span>standard --vmm-id<span class="o">=</span>...
</code></pre></td></tr></table></div>
</div>
</div><p>Terminate a running VM:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">sudo firebuild <span class="nb">kill</span> --profile<span class="o">=</span>standard --vmm-id<span class="o">=</span>...
</code></pre></td></tr></table></div>
</div>
</div><h3 id="unclean-shutdowns"><a href="#unclean-shutdowns" class="anchor-link">§</a>unclean shutdowns</h3>
<p>Firecracker VMs will stop when a <code>reboot</code> command is issued in the guest. I call these <em>unclean</em> meaning that they <em>will leave a bunch of VM related directories on disk</em>:</p>
<ul>
<li>the jail directory</li>
<li>the run cache directory</li>
<li>the CNI cache for the VM interface and a veth pair</li>
</ul>
<p>To mass-clean all these for all exited VMs, run:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">sudo firebuild purge --profile<span class="o">=</span>standard
</code></pre></td></tr></table></div>
</div>
</div><h3 id="profile-commands"><a href="#profile-commands" class="anchor-link">§</a>profile commands</h3>
<p>List profiles:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">sudo firebuild profile-ls
</code></pre></td></tr></table></div>
</div>
</div><p>Inspect a profile:</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">sudo firebuild profile-inspect --profile<span class="o">=</span>...
</code></pre></td></tr></table></div>
</div>
</div><p>Profiles may be updated by issuing subsequent <code>profile-create</code> commands with a name of an existing profile.</p>
<h2 id="whats-coming-next"><a href="#whats-coming-next" class="anchor-link">§</a>what&rsquo;s coming next</h2>
<p>These are still early stages for <code>firebuild</code>. There are many things to improve.</p>
<h3 id="short-term"><a href="#short-term" class="anchor-link">§</a>short term</h3>
<ul>
<li>tests, tests, tests, &hellip;, end to end tests</li>
<li>remove the requirement to have SSH access during <code>rootfs</code> build and move to the <code>MMDS / vminit</code> build</li>
<li>add support for building directly from Docker images for special cases where the Dockerfile might not be available or is difficult to handle, and example is Jaeger Docker image where the Dockerfile does not incorporate the binary artifact build</li>
<li>add a command to build a Linux kernel image directly from the tool</li>
<li>manage <code>resolv.conf</code> and <code>nsswitch.conf</code> on the guest</li>
</ul>
<h3 id="mid-term"><a href="#mid-term" class="anchor-link">§</a>mid term</h3>
<ul>
<li>add service catalog support for service service discovery</li>
<li>add support for additional disks</li>
<li>a VM management API</li>
<li>an event bus / hook to be able to react to events originating in <code>firebuild</code></li>
</ul>
<h3 id="long-term"><a href="#long-term" class="anchor-link">§</a>long term</h3>
<ul>
<li>enable rootfs build and run related operation split via remote build and run operators</li>
<li>provide a remote registry type of system to host rootfs and kernel files externally</li>
<li>add networking tools to create CNI bridge and overlay networks and expose VMs on outside of the host</li>
</ul>
<p>And probably many, many more as the time goes by. I&rsquo;ll be writing more as <code>firebuild</code> develops.</p>
<p>Thanks for reading. Stay safe.</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p><a href="https://github.com/combust-labs/firebuild" target="_blank" rel="noopener">The source code is on GitHub</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" class="icon footnote-icon"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg></a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p><a href="https://gruchalski.com/posts/2021-03-22-firebuild-prerequisites/" target="_blank" rel="noopener">firebuild prerequisites</a> <a href="#fnref:2" class="footnote-backref" role="doc-backlink"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" class="icon footnote-icon"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg></a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p><a href="https://github.com/combust-labs/firebuild#caveats-when-building-from-the-url" target="_blank" rel="noopener">Caveats when building from the URL</a> <a href="#fnref:3" class="footnote-backref" role="doc-backlink"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" class="icon footnote-icon"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg></a></p>
</li>
<li id="fn:4" role="doc-endnote">
<p><a href="https://github.com/combust-labs/firebuild-mmds" target="_blank" rel="noopener">firebuild-mmds GitHub repository</a> <a href="#fnref:4" class="footnote-backref" role="doc-backlink"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" class="icon footnote-icon"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg></a></p>
</li>
</ol>
</section>

            </div>

            <div class="subscribe-container">

    <h2 class="subscribe">Never miss a post</h2>
    <p class="subscribe">Interested in similar content? Get it right into your mailbox. <strong>Sign up now.</strong></p>

    <div class="inner">
        <form action="https://gruchalski.us1.list-manage.com/subscribe/post?u=7cc31051b7ae9b4636244cbb2&amp;id=80eb233246"
            method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate>
            
            <div class="away" aria-hidden="true"><input type="text" name="b_7cc31051b7ae9b4636244cbb2_80eb233246" tabindex="-1" value=""></div>
            <div class="form-fields">
                <input type="email" value="" name="EMAIL" placeholder="email address" />
                <input type="submit" value="Subscribe" name="subscribe" />
            </div>
        </form>
    </div>

</div>
            
    
    
        <ul class="post-copyright">
            <li class="copyright-item author"><span class="copyright-item-text">Author</span>: <a href="https://io-oi.me/" class="p-author h-card" target="_blank" rel="noopener">radek gruchalski</a></li>
            
                
                
                
                
                <li class="copyright-item link"><span class="copyright-item-text">Link</span>: <a href="/posts/2021-03-23-introducing-firebuild/" target="_blank" rel="noopener">https://gruchalski.com/posts/2021-03-23-introducing-firebuild/</a></li>
            
            <li class="copyright-item license"><span class="copyright-item-text">License</span>: <a href="https://en.wikipedia.org/wiki/Canonical_link_element" target="_blank" rel="noopener">reposting requires attribution, <strong>use canonical links</strong> »</a></li>
            
        </ul>
    



        </article>

        

        


        


        <div class="post-share">

        

        <div class="share-items">

            
                <div class="share-item twitter">
                    
                    <a href="https://twitter.com/share?url=https://gruchalski.com/posts/2021-03-23-introducing-firebuild/&amp;text=Introducing%20firebuild&amp;hashtags=firecracker,microvm,firebuild,docker,&amp;via=%25!s%28%3cnil%3e%29" title="Share on Twitter" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon twitter-icon"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a>
                </div>
            

            

            
                <div class="share-item linkedin">
                    
                    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://gruchalski.com/posts/2021-03-23-introducing-firebuild/&amp;title=Introducing%20firebuild&amp;summary=Manage%20firecracker%20root%20file%20systems%20and%20VMMs&amp;source=gruchalski.com" title="Share on LinkedIn" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon linkedin-icon"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg></a>
                </div>
            

            

            

            

            

            

            
                <div class="share-item qrcode">
                    <div class="qrcode-container" title="Share via QR Code"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon qrcode-icon"><path d="M0 224h192V32H0v192zM64 96h64v64H64V96zm192-64v192h192V32H256zm128 128h-64V96h64v64zM0 480h192V288H0v192zm64-128h64v64H64v-64zm352-64h32v128h-96v-32h-32v96h-64V288h96v32h64v-32zm0 160h32v32h-32v-32zm-64 0h32v32h-32v-32z"/></svg><div id="qrcode-img"></div>
                    </div>
                    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>

<script>
    var typeNumber = 0;
    var errorCorrectionLevel = 'L';
    var qr = qrcode(typeNumber, errorCorrectionLevel);
    qr.addData('https:\/\/gruchalski.com\/posts\/2021-03-23-introducing-firebuild\/');
    qr.make();
    document.getElementById('qrcode-img').innerHTML = qr.createImgTag();
</script>

                </div>
            

        </div>

    </div>




        
    
    
        <div class="related-posts">
            <h2 class="related-title">See Also:<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon related-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92h-92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"/></svg></h2>
            <ul class="related-list">
                
                    <li class="related-item">
                        <a href="/posts/2021-04-14-launching-consul-cluster-with-firebuild/" class="related-link">Launching Consul cluster with firebuild and other news</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/2021-03-03-thoughts-on-creating-vmms-from-docker-images/" class="related-link">Thoughts on creating VMMs from Docker images</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/2021-02-13-launching-alpine-linux-on-firecracker-like-a-boss/" class="related-link">Launching Alpine Linux on Firecracker like a boss</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/2021-02-19-the-jailer/" class="related-link">The jailer</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/posts/2021-02-18-its-all-about-the-iface-name/" class="related-link">It&rsquo;s all about the the Iface name</a>
                    </li>
                
            </ul>
        </div>
    



        
    
        <div class="post-tags">
            
                
                
                
                
                    
                    <a href="/tags/firecracker/" rel="tag" class="post-tags-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>firecracker</a>
                
            
                
                
                
                
                    
                    <a href="/tags/microvm/" rel="tag" class="post-tags-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>microvm</a>
                
            
                
                
                
                
                    
                    <a href="/tags/firebuild/" rel="tag" class="post-tags-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>firebuild</a>
                
            
                
                
                
                
                    
                    <a href="/tags/docker/" rel="tag" class="post-tags-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>docker</a>
                
            
        </div>
    



        


        


        
    
        
        
    
    
    
    
        <ul class="post-nav">
            
                <li class="post-nav-prev">
                    <a href="/posts/2021-03-28-firebuild-rootfs-grpc-with-mtls/" rel="prev">&lt; firebuild rootfs - gRPC with mTLS</a>
                </li>
            
            
                <li class="post-nav-next">
                    <a href="/posts/2021-03-22-firebuild-prerequisites/" rel="next">firebuild prerequisites &gt;</a>
                </li>
            
        </ul>
    



        


    </div>
</main>


            
    <div id="back-to-top" class="back-to-top">
        <a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a>
    </div>


            
    <footer id="footer" class="footer">
        <div class="footer-inner">
            <div class="site-info">©&nbsp;2015–2021&nbsp;<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon footer-icon"><path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"/></svg>&nbsp;radek gruchalski</div><div class="powered-by">Powered by <a href="https://github.com/gohugoio/hugo" target="_blank" rel="noopener">Hugo</a> | Theme is <a href="https://github.com/reuixiy/hugo-theme-meme" target="_blank" rel="noopener">MemE</a></div><div class="site-copyright"><a href="https://en.wikipedia.org/wiki/Canonical_link_element" target="_blank" rel="noopener">reposting requires attribution, <strong>use canonical links</strong> »</a></div>

            
    
        <ul class="socials"><li class="socials-item">
                    <a href="/rss.xml" target="_blank" rel="external noopener" title="RSS"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon social-icon"><path d="M19.199 24C19.199 13.467 10.533 4.8 0 4.8V0c13.165 0 24 10.835 24 24h-4.801zM3.291 17.415c1.814 0 3.293 1.479 3.293 3.295 0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526 0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727 0 15.909 7.184 15.909 15.91z"/></svg></a>
                </li><li class="socials-item">
                    <a href="mailto:radek@gruchalski.com" target="_blank" rel="external noopener" title="Email"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon social-icon"><path d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"/></svg></a>
                </li><li class="socials-item">
                    <a href="https://github.com/radekg" target="_blank" rel="external noopener" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon social-icon"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
                </li><li class="socials-item">
                    <a href="https://linkedin.com/in/radgruchalski" target="_blank" rel="external noopener" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon social-icon"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg></a>
                </li></ul>
    



            <p>this website uses Google Analytics but<br />
    it respects your DNT settings, stores tracking ID in session storage instead of cookies and anonymizes IP addresses </p>
        </div>
    </footer>


        </div>
        

        








    <script src="https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js"></script>

<script>
    mediumZoom(document.querySelectorAll('div.post-body img'), {
        background: 'hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)'
    })
</script>




    <script src="https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js" type="module" defer></script>







    </body>
</html>
